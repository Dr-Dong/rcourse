<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>The Big Page</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Data Analysis in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Overview
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="calendar.html">Schedule</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Modules
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="module1.html">M1:  Base R</a>
    </li>
    <li>
      <a href="module2.html">M2: Tidyverse Data Preparation</a>
    </li>
    <li>
      <a href="module3.html">M3: Programming, joining data, and more</a>
    </li>
    <li>
      <a href="module4.html">M4: Project Management and Dynamic Documents</a>
    </li>
    <li>
      <a href="module5.html">M5: Regression Modelling and Data Visualization</a>
    </li>
    <li>
      <a href="module6.html">M6: Intro to Bayesian Methods</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="all.html">Single-page view of all modules</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Learning Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://www.datacamp.com/">DataCamp</a>
    </li>
    <li>
      <a href="https://www.rstudio.com/resources/cheatsheets/">RStudio Cheat Sheets</a>
    </li>
    <li>
      <a href="https://www.statmethods.net/">Quick-R</a>
    </li>
    <li>
      <a href="https://stackoverflow.com/">StackOverflow</a>
    </li>
    <li>
      <a href="https://www.r-bloggers.com/">R-Bloggers</a>
    </li>
    <li>
      <a href="http://r4ds.had.co.nz/">R for Data Science Online Book</a>
    </li>
    <li>
      <a href="https://style.tidyverse.org/">R Style Guide</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Downloads
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Basic R Software</li>
    <li>
      <a href="https://cran.r-project.org/">R</a>
    </li>
    <li>
      <a href="https://www.rstudio.com/">RStudio</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Latex</li>
    <li>
      <a href="https://miktex.org/download">MiKTex (Windows)</a>
    </li>
    <li>
      <a href="http://www.tug.org/mactex/mactex-download.html">MacTex (Mac)</a>
    </li>
    <li>
      <a href="https://www.tug.org/texlive/debian.html">TeX Live (Linux)</a>
    </li>
    <li>
      <a href="https://www.sumatrapdfreader.org/free-pdf-reader.html">Sumatra PDF (Windows)</a>
    </li>
    <li>
      <a href="https://skim-app.sourceforge.io/">Skim PDF (Mac)</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Version Control</li>
    <li>
      <a href="https://git-scm.com/downloads">Git</a>
    </li>
    <li>
      <a href="https://education.github.com/discount_requests/new">GitHub for Education</a>
    </li>
    <li class="divider"></li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Code
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://github.com/andrewproctor/rminicourse">Course on Github</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">“The Big Page”</h1>
<h3 class="subtitle"><em>A single page containing all the modules</em></h3>

</div>


<p><br></p>
<div id="r-basics" class="section level1">
<h1><strong>R Basics</strong></h1>
<p><br></p>
<div id="r-statistical-programming" class="section level2">
<h2><strong>R &amp; Statistical Programming</strong></h2>
<div id="purpose-of-statistical-programming-software" class="section level3">
<h3>Purpose of statistical programming software</h3>
<p>Unlike spreadsheet applications (like Excel) or point-and-click statistical analysis software (SPSS), statistical programming software is based around a script-file where the user writes a series of commands to be performed,</p>
<p><strong>Advantages of statistical programming software</strong></p>
<ul>
<li><p>Data analysis process is reproducible and transparent.</p></li>
<li><p>Due to the open-ended nature of language-based programming, there is far more versatility and customizability in what you can do with data.</p></li>
<li><p><em>Typically</em> statistical programming software has a much more comprehensive range of built-in analysis functions than spreadsheets etc.</p></li>
</ul>
<p><br></p>
</div>
<div id="characteristics-of-r" class="section level3">
<h3>Characteristics of R</h3>
<ul>
<li><p>R is an open-source language specifically designed for statistical computing (and it’s the most popular choice among statisticians)</p></li>
<li><p>Because of its popularity and open-source nature, the R community’s package development means it has the most prewritten functionality of any data analysis software.</p></li>
<li><p>Differs from software like Stata, however, in that while you can use prewritten functions, it is equally adept at programming solutions for yourself.</p></li>
<li><p>Because it’s usage is broader, R also has a steeper learning curve than Stata.</p></li>
</ul>
<p><br></p>
</div>
<div id="comparison-to-other-statistical-programming-software" class="section level3">
<h3>Comparison to other statistical programming software</h3>
<ul>
<li><strong>Stata</strong>: The traditional choice of (academic) economists.
<ul>
<li>Stata is more specifically econometrics focused and is much more command-oriented. Easier to use for standard applications, but if there’s not a Stata command for what you want to do, it’s harder to write something yourself.<br />
</li>
<li>Stata is also very different than R in that you can only ever work with one dataset at a time, while in R, it’s typical to have a number of data objects in the environment.</li>
</ul></li>
<li><p><strong>SAS</strong>: Similar to Stata, but more commonly used in business &amp; the private sector, in part because it’s typically more convenient for massive datasets. Otherwise, I think it’s seen as a bit older and less user-friendly.</p></li>
<li><p><strong>Python</strong>: Another option based more on programming from scratch and with less prewritten commands. Python isn’t specific to math &amp; statistics, but instead is a general programming language used across a range of fields.<br />
Probably the most similar software choice to R at this point, with better general use (and programming ease) at the cost of less package development specific to econometrics/data analysis.</p></li>
<li><p><strong>Matlab</strong>: Popular in macroeconomics and theory work, not so much in empirical work. Matlab is powerful, but is much more based on programming “from scratch” using matrices and mathematical expressions.</p></li>
</ul>
<p><br></p>
</div>
<div id="useful-resources-for-learning-r" class="section level3">
<h3>Useful resources for learning R</h3>
<ul>
<li><strong>DataCamp:</strong> interactive online lessons in R.
<ul>
<li>Some of the courses are free (particularly community-written lessons like the one you’ll do today), but for paid courses, DataCamp costs about 300 SEK / mo.</li>
</ul></li>
<li><p><strong>RStudio Cheat Sheets:</strong> Very helpful 1-2 page overviews of common tasks and packages in R.</p></li>
<li><p><strong>Quick-R:</strong> Website with short example-driven overviews of R functionality.</p></li>
<li><p><strong>StackOverflow:</strong> Part of the Stack Exchange network, StackOverflow is a Q&amp;A community website for people who work in programming. Tons of incredibly good R users and developers interact on StackExchange, so it’s a great place to search for answers to your questions.</p></li>
<li><p><strong>R-Bloggers:</strong> Blog aggregagator for posts about R. Great place to learn really cool things you can do in R.</p></li>
<li><p><strong>R for Data Science:</strong> Online version of the book by Hadley Wickham, who has written many of the best packages for R, including the Tidyverse, which we will cover.</p></li>
</ul>
<p><br> <br></p>
</div>
</div>
<div id="getting-started-in-r" class="section level2">
<h2><strong>Getting Started in R</strong></h2>
<p><br></p>
<div id="rstudio-gui" class="section level3">
<h3>RStudio GUI</h3>
<p>RStudio is an is an integrated development environment (IDE).</p>
<p>This means that in addition to a script editor, it also let’s you view your environments, data objects, plots, help files, etc directly within the application.</p>
<div class="figure">
<img src="assets/RStudioGUI.png" />

</div>
<p><br></p>
</div>
<div id="executing-code-from-the-script" class="section level3">
<h3>Executing code from the script</h3>
<p>To execute a section of code, highlight the code and click “Run” or use Ctrl-Enter.</p>
<ul>
<li><p>For a single line of code, you don’t need to highlight, just click into that line.</p></li>
<li><p>To execute the whole document, the hotkey is Ctrl-Shift-Enter.</p></li>
</ul>
<p><br></p>
</div>
<div id="style-advise" class="section level3">
<h3>Style advise</h3>
<p>Unlike Stata, with R you don’t need any special code to write multiline code - it’s already the default (functions are written with parentheses, so its clear when the line actually ends.)</p>
<ul>
<li><p>So there’s no excuse for really long lines. Accepted style suggests using a 80-character limit for your lines.</p></li>
<li>RStudio has the option to show a guideline for margins. <strong>Use it!</strong>
<ul>
<li>Go to <strong>Tools -&gt; Global Options -&gt; Code -&gt; Display</strong>, then select <strong>Show Margin</strong> and enter 80 characters.</li>
</ul></li>
</ul>
<p>You can also write multiple expressions on the same line by using <span style="color:blue">;</span> as a manual line break.</p>
<p><br></p>
</div>
<div id="comments" class="section level3">
<h3>Comments</h3>
<p>To create a comment in R, use a hash (<span style="color:blue"> <strong>#</strong></span>. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Here I add 2 + 2</span>
<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p><br></p>
</div>
<div id="help-files-in-r" class="section level3">
<h3>Help files in R</h3>
<p>You can access the help file for any given function using the <strong>help function.</strong> You can call it a few different ways:</p>
<ol style="list-style-type: decimal">
<li>In the console, use <span style="color:blue"> <strong>help()</strong></span></li>
<li>In the console, use <span style="color:blue"> <strong>?</strong></span> immediately followed by the name of the function (no space inbetween)</li>
<li>In the Help pane, search for the function in question.</li>
</ol>
<p><span style="color:blue"> <strong>?</strong></span> is shorter, so that’s the most frequent method.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Help on the lm (linear regression) function</span>
?lm</code></pre></div>
<p><br></p>
</div>
<div id="setting-the-working-directory" class="section level3">
<h3>Setting the working directory</h3>
<p>To set the working directory, use the function <span style="color:blue"> <strong>setwd()</strong></span>. The argument for the function is simply the path to the working directory, in quotes.</p>
<p>However: be sure that the slashes in the path are forward slashes (/). For Windows, this is not the case if you copy the path from File Explorer so you’ll need to change them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set Working Directory</span>
<span class="kw">setwd</span>(<span class="st">&quot;C:/Users/Andrew/Documents/MyProject&quot;</span>)</code></pre></div>
<p><br> <br></p>
</div>
</div>
<div id="data-types-operations" class="section level2">
<h2><strong>Data Types &amp; Operations</strong></h2>
<div id="math-operations-in-r" class="section level3">
<h3>Math operations in R</h3>
<p>Examples of basic mathematical operations in R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Addition and Subtraction</span>
<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Multiplication and Division</span>
<span class="dv">2</span><span class="op">*</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">/</span><span class="dv">2</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Exponentiation and Logarithms</span>
<span class="dv">2</span><span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] 4.693147</code></pre>
<p><br></p>
</div>
<div id="logical-operations-in-r" class="section level3">
<h3>Logical operations in R</h3>
<p>You can also evaluate logical expressions in R</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Less than
<span class="dv">5</span> <span class="op">&lt;=</span><span class="st"> </span><span class="dv">6</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Greater than or equal to
<span class="dv">5</span> <span class="op">&gt;=</span><span class="st"> </span><span class="dv">6</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Equality
<span class="dv">5</span> <span class="op">==</span><span class="st"> </span><span class="dv">6</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Negatiion
<span class="dv">5</span> <span class="op">!=</span><span class="st"> </span><span class="dv">6</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>You can also use AND (<span style="color:blue"> <strong>&amp;</strong></span>) and OR (<span style="color:blue"> <strong>|</strong></span>) operation with logical expressions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Is 5 equal to 5 OR 5 is equal to 6
(<span class="dv">5</span> <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">|</span><span class="st"> </span>(<span class="dv">5</span> <span class="op">==</span><span class="st"> </span><span class="dv">6</span>)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## 5 less 6 AND 6 &lt; 5
(<span class="dv">5</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">6</span>) <span class="op">&amp;</span><span class="st"> </span>(<span class="dv">7</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">6</span>)</code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p><br></p>
</div>
<div id="defining-an-object" class="section level3">
<h3>Defining an object</h3>
<p>To define an object, use <span style="color:blue"><strong>&lt;-</strong></span>. For example</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Assign 2 + 2 to the variable x</span>
x &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></code></pre></div>
<p><strong>Note:</strong> In R, there is no distinction between defining and redefining an object (<em>a la</em> gen/replace in Stata).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="dv">4</span> <span class="co"># Define y</span>
y &lt;-<span class="st"> </span>y<span class="op">^</span><span class="dv">2</span> <span class="co"># Redefine y</span>
y <span class="co">#Print y </span></code></pre></div>
<pre><code>## [1] 16</code></pre>
<p><br></p>
</div>
<div id="data-classes" class="section level3">
<h3>Data classes</h3>
<p>Data elements in R are categorized into a few seperate classes (ie types)</p>
<ul>
<li><p><strong>numeric</strong>: Data that should be interpreted as a number.</p></li>
<li><p><strong>logical:</strong> Data that should be interpreted as a logical statment, ie. TRUE or FALSE.</p></li>
<li><strong>character</strong>: Strings/text.
<ul>
<li>Note, depending on how you format your data, elements that may look like logical or numeric may instead be character.</li>
</ul></li>
<li><p><strong>factor</strong>: In affect, a categorical variable. Value may be text, but R interprets the variable as taking on one of limited number of possible values (e.g. sex, municipality, industry etc)</p></li>
</ul>
<p><br></p>
</div>
<div id="whats-the-object-class" class="section level3">
<h3>What’s the object class?</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="dv">2</span>; <span class="kw">class</span>(a)</code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b &lt;-<span class="st"> &quot;2&quot;</span>; <span class="kw">class</span>(b)</code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">c &lt;-<span class="st"> </span><span class="ot">TRUE</span>; <span class="kw">class</span>(c)</code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> &quot;True&quot;</span>; <span class="kw">class</span>(d)</code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="vectors-matrices" class="section level2">
<h2><strong>Vectors &amp; Matrices</strong></h2>
<p><br></p>
<div id="vectors" class="section level3">
<h3>Vectors</h3>
<p>The basic data structure containing multiple elements in R is the vector.</p>
<ul>
<li><p>An R vector is much like the typical view of a vector in mathematics, ie it’s basically a 1D array of elements.</p></li>
<li><p>Typical vectors are of a single-type (these are called atomic vectors).</p></li>
<li><p>A <em>list</em> vector can also have elements of different types.</p></li>
</ul>
<p><br></p>
</div>
<div id="creating-vectors" class="section level3">
<h3>Creating vectors</h3>
<p>To create a vector, use the function <span style="color:blue"><strong>c()</strong></span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create `days` vectors</span>
days &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mon&quot;</span>,<span class="st">&quot;Tues&quot;</span>,<span class="st">&quot;Wed&quot;</span>,
           <span class="st">&quot;Thurs&quot;</span>, <span class="st">&quot;Fri&quot;</span>)

<span class="co"># Create `temps` vectors</span>
temps &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">13</span>,<span class="dv">18</span>,<span class="dv">17</span>,<span class="dv">20</span>,<span class="dv">21</span>)
<span class="co"># Display `temps` vector</span>
temps</code></pre></div>
<pre><code>## [1] 13 18 17 20 21</code></pre>
<p><br></p>
</div>
<div id="naming-vectors" class="section level3">
<h3>Naming vectors</h3>
<p>You can name a vector by assigning a vector of names to <span style="color:blue"><strong>c()</strong></span>, where the vector to be named goes in the parentheses.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Assign `days` as names for `temps` vector</span>
<span class="kw">names</span>(temps) &lt;-<span class="st"> </span>days 
<span class="co"># Display `temps` vector</span>
temps</code></pre></div>
<pre><code>##   Mon  Tues   Wed Thurs   Fri 
##    13    18    17    20    21</code></pre>
<p><br></p>
</div>
<div id="subsetting-vectors" class="section level3">
<h3>Subsetting vectors</h3>
<p>There are multiple ways of subsetting data in R. One of the easiest methods for vectors is to put the subset condition in brackets:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Subset temps greater than or equal to 10</span>
temps[temps<span class="op">&gt;=</span><span class="dv">18</span>]</code></pre></div>
<pre><code>##  Tues Thurs   Fri 
##    18    20    21</code></pre>
<p><br></p>
</div>
<div id="operations-on-vectors" class="section level3">
<h3>Operations on vectors</h3>
<p>Operations on vectors are element-wise. So if 2 vectors are added together, each element of the <span class="math inline">\(2^{nd}\)</span> vector would be added to the corresponding element from the <span class="math inline">\(1^{st}\)</span> vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Temp vector for week 2</span>
temps2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">16</span>)
<span class="kw">names</span>(temps2) &lt;-<span class="st"> </span>days
<span class="co"># Create average temperature by day</span>
avg_temp &lt;-<span class="st"> </span>(temps <span class="op">+</span><span class="st"> </span>temps2) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>
<span class="co"># Display `avg_temp`</span>
avg_temp</code></pre></div>
<pre><code>##   Mon  Tues   Wed Thurs   Fri 
##  10.5  14.0  13.5  17.5  18.5</code></pre>
<p><br></p>
</div>
<div id="matrices" class="section level3">
<h3>Matrices</h3>
<ul>
<li><p>Data in a 2-dimensional structure can be represented in two formats, as a <em>matrix</em> or as a <em>data frame.</em></p></li>
<li>A matrix is used for 2D data structures of a single data type (like atomic vectors).
<ul>
<li>Usually, matrices are composed of numeric objects.</li>
</ul></li>
<li><p>To create a matrix, use the <span style="color:blue"><strong>matrix()</strong></span> command.</p></li>
</ul>
<p>The syntax of <span style="color:blue">** matrix() **</span> is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">matrix</span>(x, <span class="dt">nrow=</span>a, <span class="dt">ncol=</span>b, <span class="dt">byrow=</span><span class="ot">FALSE</span><span class="op">/</span><span class="ot">TRUE</span>)</code></pre></div>
<p>-<em>x</em> is the data that will populate the matrix.</p>
<p>-<em>nrow</em> and <em>ncol</em> specify the number of rows and columns, respectively.<br />
Generally need to specify just 1 since the number of elements and a single condition will determine the other.</p>
<p>-<em>byrow</em> specifies whether to fill in the elements by row or column. The default is <span style="color:blue"><strong>byrow=FALSE</strong></span>, ie the data is filled in by column.</p>
<p><br></p>
</div>
<div id="creating-a-matrix-from-scratch" class="section level3">
<h3>Creating a matrix from scratch</h3>
<p>A simple example of creating a matrix would be:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">nrow=</span><span class="dv">2</span>, <span class="dt">ncol=</span><span class="dv">3</span>, <span class="dt">byrow=</span><span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    3    5
## [2,]    2    4    6</code></pre>
<p>Note the difference in appearance if we instead <strong>byrow=TRUE</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">nrow=</span><span class="dv">2</span>, <span class="dt">ncol=</span><span class="dv">3</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    4    5    6</code></pre>
<p>Using the same <span style="color:blue"><strong>c()</strong></span> function as in the creation of a vector, we can specify the values of a matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">13</span>,<span class="dv">18</span>,<span class="dv">17</span>,<span class="dv">20</span>,<span class="dv">21</span>,
         <span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">16</span>), 
         <span class="dt">nrow=</span><span class="dv">2</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]   13   18   17   20   21
## [2,]    8   10   10   15   16</code></pre>
<ul>
<li>Note that the line breaks in the code are purely for<br />
readability purposes. Unlike Stata, R allows you to break<br />
code over multiple lines without any extra line break syntax.</li>
</ul>
<p><br></p>
</div>
<div id="creating-a-matrix-from-vectors" class="section level3">
<h3>Creating a matrix from vectors</h3>
<p>Instead of entering in the matrix data yourself, you may want to make a matrix from existing data vectors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create temps matrix</span>
temps.matrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(temps,temps2), <span class="dt">nrow=</span><span class="dv">2</span>, 
                        <span class="dt">ncol=</span><span class="dv">5</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)
<span class="co"># Display matrix</span>
temps.matrix</code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]   13   18   17   20   21
## [2,]    8   10   10   15   16</code></pre>
<p><br></p>
</div>
<div id="naming-rows-and-columns" class="section level3">
<h3>Naming rows and columns</h3>
<p>-Naming rows and columns of a matrix is pretty similar to naming vectors.</p>
<p>-Only here, instead of using <span style="color:blue"><strong>names()</strong></span>, we use <span style="color:blue"><strong>rownames()</strong></span> and <span style="color:blue"><strong>colnames()</strong></span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create temps matrix</span>
<span class="kw">rownames</span>(temps.matrix) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Week1&quot;</span>, <span class="st">&quot;week2&quot;</span>)
<span class="kw">colnames</span>(temps.matrix) &lt;-<span class="st"> </span>days
<span class="co"># Display matrix</span>
temps.matrix</code></pre></div>
<pre><code>##       Mon Tues Wed Thurs Fri
## Week1  13   18  17    20  21
## week2   8   10  10    15  16</code></pre>
<p><br></p>
</div>
<div id="matrix-operations" class="section level3">
<h3>Matrix operations</h3>
<p>In R, matrix multiplication is denoted by <span style="color:blue"><strong>%<span class="math inline">\(*\)</span>%</strong></span>, as in <span style="color:blue"><strong>A %<span class="math inline">\(*\)</span>% B</strong></span></p>
<p><span style="color:blue"><strong>A * B</strong></span> instead performs <em>element-wise</em> (Hadamard) multiplication of matrices, so that <span style="color:blue"><strong>A * B</strong></span> has the entries <span class="math inline">\(a_1 b_1\)</span>, <span class="math inline">\(a_2 b_2\)</span> etc.</p>
<ul>
<li>An important thing to be aware of with R’s <span style="color:blue"><strong>A * B</strong></span> notation, however, is that if either of the terms is a 2D vector, the terms of this vector will be distributed elementwise to each colomn of the matrix.</li>
</ul>
<p><br></p>
</div>
<div id="elementwise-operations-with-a-vector-and-matrix" class="section level3">
<h3>Elementwise operations with a vector and Matrix</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vecA; matB</code></pre></div>
<pre><code>## [1] 1 2</code></pre>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    4    5    6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vecA <span class="op">*</span><span class="st"> </span>matB</code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    8   10   12</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="data-frames" class="section level2">
<h2><strong>Data Frames</strong></h2>
<p><br></p>
<div id="creating-a-data-frame" class="section level3">
<h3>Creating a data frame</h3>
<ul>
<li><p>Most of the time you’ll probably be working with datasets that are recognized as data frames when imported into R.</p></li>
<li><p>But you can also easily create your own data frames.</p></li>
<li><p>This might be as simple as converting a matrix to a data frame:</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydf &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(matB)
mydf</code></pre></div>
<pre><code>##   V1 V2 V3
## 1  1  2  3
## 2  4  5  6</code></pre>
<ul>
<li>Another way of creating a data frame is to combine other vectors or matrices (of the same length) together.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydf &lt;-<span class="st"> </span><span class="kw">data.frame</span>(vecA,matB)
mydf</code></pre></div>
<pre><code>##   vecA X1 X2 X3
## 1    1  1  2  3
## 2    2  4  5  6</code></pre>
<p><br></p>
</div>
<div id="defining-a-column-of-a-data-frame-or-other-2d-object" class="section level3">
<h3>Defining a column of a data frame (or other 2D object):</h3>
<p>Once you have a multidimensional data object, you will usually want to create or manipulate particular columns of the object.</p>
<p>The default way of invoking a named column in R is by appending a dollar sign and the column name to the data object.</p>
<p><br></p>
<div id="example-of-adding-a-new-column-to-a-data-frame" class="section level4">
<h4>Example of adding a new column to a data frame</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages <span class="co"># View wages data frame</span></code></pre></div>
<pre><code>##        wage schooling    sex exper
## 1 134.23058        13 female     8
## 2 249.67744        13 female    11
## 3  53.56478        10 female    11</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages<span class="op">$</span>expersq &lt;-<span class="st"> </span>wages<span class="op">$</span>exper<span class="op">^</span><span class="dv">2</span>; wages  <span class="co"># Add expersq</span></code></pre></div>
<pre><code>##        wage schooling    sex exper expersq
## 1 134.23058        13 female     8      64
## 2 249.67744        13 female    11     121
## 3  53.56478        10 female    11     121</code></pre>
<p><br></p>
</div>
</div>
<div id="viewing-the-structure-of-a-data-frame" class="section level3">
<h3>Viewing the structure of a data frame</h3>
<p>Like viewing the class of a homogenous data object, it’s often helpful to view the structure of data frames (or other 2D objects).</p>
<ul>
<li>You can easily do this using the <span style="color:blue">** str() **</span> function.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># View the structure of the wages data frame</span>
<span class="kw">str</span>(wages)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3 obs. of  5 variables:
##  $ wage     : num  134.2 249.7 53.6
##  $ schooling: int  13 13 10
##  $ sex      : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 1 1 1
##  $ exper    : int  8 11 11
##  $ expersq  : num  64 121 121</code></pre>
<p><br></p>
</div>
<div id="changing-the-structure-of-a-data-frame" class="section level3">
<h3>Changing the structure of a data frame</h3>
<p>A common task is to redefine the classes of columns in a data frame.</p>
<ul>
<li><p>Common commands can help you with this when the data is formatted suitably:</p>
<ul>
<li><p><span style="color:blue"><strong>as.numeric()</strong></span> will take data that <em>looks like numbers</em> but are formatted as characters/factors and change their formatting to numeric.</p></li>
<li><p><span style="color:blue"><strong>as.character()</strong></span> will take data formatted as numbers/factors and change their class to character.</p></li>
<li><p><span style="color:blue"><strong>as.factor()</strong></span> will reformat data as factors, taking by default the unique values of each column as the possible factor levels.</p></li>
</ul></li>
</ul>
<p><br></p>
</div>
<div id="more-about-factors" class="section level3">
<h3>More about factors</h3>
<p>Although <span style="color:blue"><strong>as.factor()</strong></span> will suggest factors from the data, you may want more control over how factors are specified.</p>
<p>With the <span style="color:blue"><strong>factor()</strong></span> function, you supply the possible values of the factor and you can also specify ordering of factor values if your data is ordinal.</p>
<p><br></p>
<div id="example-of-creating-ordered-factors" class="section level4">
<h4>Example of creating ordered factors</h4>
<p>A dataset on number of extramarital affairs from Fair (Econometrica 1977) has the following variables: number of affairs, years married, presence of children, and a self-rated (Likert scale) 1-5 measure of marital happiness.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(affairs) <span class="co"># view structure</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3 obs. of  4 variables:
##  $ affairs: num  0 0 1
##  $ yrsmarr: num  15 1.5 7
##  $ child  : Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 2 1 2
##  $ mrating: int  1 5 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Format mrating as ordered factor
affairs<span class="op">$</span>mrating &lt;-<span class="kw">factor</span>(affairs<span class="op">$</span>mrating, 
   <span class="dt">levels=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>), <span class="dt">ordered=</span><span class="ot">TRUE</span>)
<span class="kw">str</span>(affairs)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3 obs. of  4 variables:
##  $ affairs: num  0 0 1
##  $ yrsmarr: num  15 1.5 7
##  $ child  : Factor w/ 2 levels &quot;no&quot;,&quot;yes&quot;: 2 1 2
##  $ mrating: Ord.factor w/ 5 levels &quot;1&quot;&lt;&quot;2&quot;&lt;&quot;3&quot;&lt;&quot;4&quot;&lt;..: 1 5 3</code></pre>
<p>Note that the marital rating (<em>mrating</em>) initially was stored as an integer, which is incorrect. Using factors preserves the ordering while not asserting a numerical relationship between values.</p>
<p><br></p>
</div>
</div>
<div id="selections-and-subsets-in-data-frames" class="section level3">
<h3>Selections and subsets in data frames</h3>
<p>Similar to subsetting a vector, matrices &amp; data frames can also be subsetted for both rows and columns by placing the selection arguments in brackets after the name of the data object:</p>

<p>Arguments can be:</p>
<ul>
<li><p>Row or column numbers (eg mydf[1,3])</p></li>
<li><p>Row or column names</p></li>
<li><p>Rows (ie observations) that meet a given condition</p></li>
</ul>
<p><br></p>
<div id="example-of-subsetting-a-data-frame" class="section level4">
<h4>Example of subsetting a data frame</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Subset of wages df with schooling &gt; 10, exper &gt; 10</span>
wages[(wages<span class="op">$</span>schooling <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">&amp;</span><span class="st"> </span>(wages<span class="op">$</span>exper <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>),]</code></pre></div>
<pre><code>##       wage schooling    sex exper expersq
## 2 249.6774        13 female    11     121</code></pre>
<p><strong>Notice</strong> that the column argument was left empty, so all columns are returned by default.</p>
<p><br> <br></p>
</div>
</div>
</div>
</div>
<div id="data-preparation-using-the-tidyverse" class="section level1">
<h1><strong>Data Preparation using the Tidyverse</strong></h1>
<p><br></p>
<div id="packages-in-r" class="section level2">
<h2><strong>Packages in R</strong></h2>
<div id="role-of-packages-in-r" class="section level3">
<h3>Role of Packages in R</h3>
<ul>
<li><p>Packages in R are similar to user-written commands (think <em>ssc install</em>) in Stata.</p></li>
<li><p>But <em>most</em> things you do in Stata probably use core Stata commands.</p></li>
<li><p>In R, most of your analysis will probably be done using packages.</p></li>
</ul>
<p><br></p>
<div class="figure">
<img src="data/cran.png" />

</div>
<p><br></p>
</div>
<div id="installing-and-using-a-package" class="section level3">
<h3>Installing and using a package</h3>
<ul>
<li><p>To install a package, use the function (preferably in the console) <a href="https://www.rdocumentation.org/packages/utils/versions/3.4.3/topics/install.packages">install.packages()</a></p></li>
<li>To begin with, let’s install 2 packages:
<ul>
<li><a href="https://www.rdocumentation.org/packages/tidyverse">tidyverse</a>: the umbrella package for common data preparation and visualization in R.</li>
<li><a href="https://www.rdocumentation.org/packages/rio">rio</a>: a package for easy data import, export (saving), and conversion.</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)    <span class="co"># Install tidyverse</span>
<span class="kw">install.packages</span>(<span class="st">&quot;rio&quot;</span>)    <span class="co"># Install rio</span></code></pre></div>
<p><br></p>
</div>
<div id="loading-a-package-during-analysis" class="section level3">
<h3>Loading a package during analysis</h3>
<p>Unlike Stata, in R you need to declare what packages you will be using at the beginning of each R document.</p>
<p>To do this, use the <a href="https://www.rdocumentation.org/packages/base/versions/3.4.3/topics/library">library()</a> function.</p>
<p>-<a href="https://www.rdocumentation.org/packages/tidyverse">require()</a> also works, but its use is discouraged for this purpose.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)    <span class="co"># Install tidyverse</span>
<span class="kw">library</span>(<span class="st">&quot;rio&quot;</span>)    <span class="co"># Install rio</span></code></pre></div>
<p><br> <br></p>
</div>
</div>
<div id="data-prep-preliminaries" class="section level2">
<h2><strong>Data Prep Preliminaries</strong></h2>
<div id="import-and-export-using-rio" class="section level3">
<h3>Import and export using rio</h3>
<p>Previously, importing and exporting data was a mess, with a lot of different functions for different file formats:</p>
<ul>
<li>Stata DTA files alone required two functions: read.dta (for Stata 6-12 DTA files), read.dta13 (for Stata 13 and later files), etc.</li>
</ul>
<p>The <a href="https://www.rdocumentation.org/packages/rio">rio</a> package simplifies this by reducing all of this to just one function, <a href="https://www.rdocumentation.org/packages/rio/versions/0.5.5/topics/import">import()</a></p>
<ul>
<li>Automatically determines the file format of the file and uses the appropriate function from other packages to load in a file.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PISA_<span class="dv">2015</span> &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;data/PISA2015.sas7bdat&quot;</span>)
PISA_<span class="dv">2015</span>[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</code></pre></div>
<pre><code>##   CNTRYID CNT CNTSCHID  CYC NatCen Region
## 1       8 ALB   800001 06MS 000800    800
## 2       8 ALB   800002 06MS 000800    800
## 3       8 ALB   800003 06MS 000800    800
## 4       8 ALB   800004 06MS 000800    800
## 5       8 ALB   800005 06MS 000800    800</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">export</span>(PISA_<span class="dv">2015</span>, <span class="st">&quot;PISA_2015.rds&quot;</span>)</code></pre></div>
<p><br></p>
</div>
<div id="tibbles-an-update-to-the-data-frame" class="section level3">
<h3>Tibbles: an update to the data frame</h3>
<p>Last class, we covered data frames—the most basic data object class for data sets with a mix of data class.</p>
<p>Today, we introduce one final data object: the <strong>tibble</strong>!</p>
<p>The tibble can be thought of as an update to the data frame—and it’s the first part of the <em>tidyverse</em> package that we’ll look at.</p>
<p><br></p>
<div id="tibble-vs-data-frames" class="section level4">
<h4>Tibble vs data frames</h4>
<p>There are three main benefits to the tibble:</p>
<ol style="list-style-type: decimal">
<li>Displaying data frames:
<ul>
<li>If you display a data frame, it will print as much as much output as allowed by the “max.print” option in the R environment. With large data sets, that’s far too much. Tibbles by default print the first 10 rows and as many columns as will fit in the window.</li>
</ul></li>
<li>Partial matching in data frames:
<ul>
<li>When using the <span style="color:blue"><strong>$</strong></span> method to reference columns of a data frame, partial names will be matched if the reference isn’t exact. This might sound good, but the only real reason for there to be a partial match is a typo, in which case the match might be wrong.</li>
</ul></li>
<li>Tibbles are required for some functions.</li>
</ol>
<p><br></p>
</div>
<div id="creating-or-converting-to-tibbles" class="section level4">
<h4>Creating or converting to tibbles</h4>
<p>The syntax for creating tibbles exactly parallels the syntax for data frames:</p>
<ul>
<li><p><a href="https://www.rdocumentation.org/packages/tibble">tibble()</a> creates a tibble from underlying data or vectors.</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/tibble/versions/1.4.2/topics/as_tibble">as_tibble()</a> coerces an existing data object into a tibble.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PISA_<span class="dv">2015</span> &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(PISA_<span class="dv">2015</span>); PISA_<span class="dv">2015</span>[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   CNTRYID CNT   CNTSCHID CYC   NatCen
##     &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1       8 ALB     800001 06MS  000800
## 2       8 ALB     800002 06MS  000800
## 3       8 ALB     800003 06MS  000800
## 4       8 ALB     800004 06MS  000800
## 5       8 ALB     800005 06MS  000800</code></pre>
<p><br></p>
</div>
</div>
<div id="glimpse" class="section level3">
<h3>Glimpse</h3>
<p>Another tidyverse function that’s very useful is <a href="https://www.rdocumentation.org/packages/tibble/versions/1.4.2/topics/glimpse">glimpse()</a> , a function very similar to <a href="https://www.rdocumentation.org/packages/utils/versions/3.4.3/topics/str">str()</a>.</p>
<ul>
<li><p>Both functions display information about the structure of a data object.</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/utils/versions/3.4.3/topics/str">str()</a> provides more information, such as column (variable) attributes embedded from external data formats, but consequently is much less readable for complex data objects.</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/tibble/versions/1.4.2/topics/glimpse">glimpse()</a> provides only column names, classes, and some data values (much more readable)</p></li>
<li><p>I will often use <a href="https://www.rdocumentation.org/packages/utils/versions/3.4.3/topics/str">str()</a> when I want more detailed information about data structure, but use <a href="https://www.rdocumentation.org/packages/tibble/versions/1.4.2/topics/glimpse">glimpse()</a> for quicker glances at the data.</p></li>
</ul>
<p><br></p>
</div>
<div id="pipes" class="section level3">
<h3>Pipes</h3>
<p>Another major convenience enhancement from the tidyverse is <strong><em>pipes</em></strong>, denoted <span style="color:blue"><strong>%&gt;%</strong></span>,</p>
<ul>
<li><p>Pipes allow you to combine multiple steps into a single piece of code.</p></li>
<li><p>Specifically, after performing a function in one step, a pipe takes the data generated from the first step and uses it as the data input to a second step.</p></li>
</ul>
<p><br></p>
<div id="pipes-example" class="section level4">
<h4>Pipes Example</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">barro.lee.data &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;data/BL2013_MF1599_v2.1.dta&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>(<span class="dt">width =</span> <span class="dv">50</span>)</code></pre></div>
<pre><code>## Observations: 1,898
## Variables: 20
## $ BLcode      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ country     &lt;chr&gt; &quot;Algeria&quot;, &quot;Algeria&quot;, &quot;Alge…
## $ year        &lt;dbl&gt; 1950, 1955, 1960, 1965, 197…
## $ sex         &lt;chr&gt; &quot;MF&quot;, &quot;MF&quot;, &quot;MF&quot;, &quot;MF&quot;, &quot;MF…
## $ agefrom     &lt;dbl&gt; 15, 15, 15, 15, 15, 15, 15,…
## $ ageto       &lt;dbl&gt; 999, 999, 999, 999, 999, 99…
## $ lu          &lt;dbl&gt; 80.68459, 81.05096, 82.6111…
## $ lp          &lt;dbl&gt; 17.563400, 17.018442, 14.31…
## $ lpc         &lt;dbl&gt; 3.745905, 3.464397, 3.06939…
## $ ls          &lt;dbl&gt; 1.454129, 1.639253, 2.75251…
## $ lsc         &lt;dbl&gt; 0.4595877, 0.4952279, 1.049…
## $ lh          &lt;dbl&gt; 0.2978759, 0.2594140, 0.322…
## $ lhc         &lt;dbl&gt; 0.16479027, 0.14177565, 0.1…
## $ yr_sch      &lt;dbl&gt; 0.8464569, 0.8350149, 0.880…
## $ yr_sch_pri  &lt;dbl&gt; 0.7443995, 0.7284052, 0.706…
## $ yr_sch_sec  &lt;dbl&gt; 0.09280412, 0.09858591, 0.1…
## $ yr_sch_ter  &lt;dbl&gt; 0.009253278, 0.008023791, 0…
## $ pop         &lt;dbl&gt; 5241, 5699, 6073, 6374, 710…
## $ WBcode      &lt;chr&gt; &quot;DZA&quot;, &quot;DZA&quot;, &quot;DZA&quot;, &quot;DZA&quot;,…
## $ region_code &lt;chr&gt; &quot;Middle East and North Afri…</code></pre>
<p><br> <br></p>
</div>
</div>
</div>
<div id="data-preparation" class="section level2">
<h2><strong>Data Preparation</strong></h2>
<div id="tidyverse-and-the-verbs-of-data-manipulation" class="section level3">
<h3>Tidyverse and the verbs of data manipulation</h3>
<p>A motivating principle behind the creation of the tidyverse was the language of programming should really behave like a language.</p>
<p>Data manipulation in the tidyverse is oriented around a few key “verbs” that perform common types of data manipulation.</p>
<ol style="list-style-type: decimal">
<li><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/filter">filter()</a> subsets the rows of a data frame based on their values.</li>
<li><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/select">select()</a> keeps variables (columns) based on their names.</li>
<li><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/mutate">mutate()</a> adds new variables that are functions of existing variables.</li>
<li><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/mutate">summarize()</a> creates a number of summary statistics out of many values.</li>
<li><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/arrange">arrange()</a> changes the ordering of the rows.</li>
</ol>
<p><strong>Note</strong>: the first argument for each these functions is the data     object (so pipe!).</p>
<p><br></p>
</div>
<div id="filtering-data" class="section level3">
<h3>Filtering data</h3>
<p>Filtering keeps observations (rows) based on conditions.</p>
<ul>
<li>Just like using use subset conditions in the row arguments of a bracketed subset</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Using brackets</span>
wages[(wages<span class="op">$</span>schooling <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">&amp;</span><span class="st"> </span>(wages<span class="op">$</span>exper <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>),] </code></pre></div>
<pre><code>##       wage schooling    sex exper
## 2 249.6774        13 female    11</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Using filter</span>
wages  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(schooling <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>,exper <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>)  </code></pre></div>
<pre><code>##       wage schooling    sex exper
## 1 249.6774        13 female    11</code></pre>
<p>Notice a couple of things about the output:</p>
<ol style="list-style-type: decimal">
<li>It doesn’t look like we told <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/filter">filter()</a> what data set we would be filtering.</li>
</ol>
<ul>
<li>That’s because the data set has already been supplied by the pipe. We could have also written the filter as:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(wages, schooling <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>,exper <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>)  </code></pre></div>
<pre><code>##       wage schooling    sex exper
## 1 249.6774        13 female    11</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>We didn’t need to use the logical <span style="color:blue"><strong>&amp;</strong></span>. Though multiple conditions can still be written in this way with filter(), the default is just to separate them with a comma.</li>
</ol>
<p><br></p>
</div>
<div id="selecting-data" class="section level3">
<h3>Selecting data</h3>
<p>Just like filter is in many ways a more convenient form of writing out bracketed row subset conditions, the verb <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/select">select()</a> is largely a more convenient method for writing column arguments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Using brackets</span>
wages_row1[,<span class="kw">c</span>(<span class="st">&quot;wage&quot;</span>,<span class="st">&quot;schooling&quot;</span>,<span class="st">&quot;exper&quot;</span>)]</code></pre></div>
<pre><code>##       wage schooling exper
## 1 134.2306        13     8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Using select</span>
wages_row1  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(wage,schooling,exper)  </code></pre></div>
<pre><code>##       wage schooling exper
## 1 134.2306        13     8</code></pre>
<p><br></p>
<div id="an-example-of-dropping-a-column" class="section level4">
<h4>An example of dropping a column</h4>
<p>One option we have not covered so far in creating subsets is dropping rows or columns.</p>
<p>R has a specific notation for this, easily used with <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/select">select()</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages_row1 <span class="co"># What wages_row1 looks like:</span></code></pre></div>
<pre><code>##       wage schooling    sex exper
## 1 134.2306        13 female     8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages_row1  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>exper) <span class="co">#drop exper</span></code></pre></div>
<pre><code>##       wage schooling    sex
## 1 134.2306        13 female</code></pre>
<p>Dropping columns (or rows) using the <span style="color:blue"><strong>-</strong></span> notation also works with brackets, but only when using the number location of the row or column to be dropped.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages_row1[,<span class="op">-</span><span class="dv">4</span>] <span class="co"># works</span></code></pre></div>
<pre><code>##       wage schooling    sex
## 1 134.2306        13 female</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># wages_row1[,-&quot;exper&quot;] does not work</span></code></pre></div>
<p>Because of the ability to use name arguments, dropping with <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/select">select()</a> is generally easier.</p>
<p><br></p>
</div>
</div>
<div id="mutating-data" class="section level3">
<h3>“Mutating” data</h3>
<p>Creating new variables that are functions of existing variables in a data set can be done with <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/mutate">mutate()</a>.</p>
<p><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/mutate">mutate()</a> takes as its first argument the data set to be used and the equation for the new variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages &lt;-<span class="st"> </span>wages <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">expsq =</span> exper<span class="op">^</span><span class="dv">2</span>) <span class="co"># Create expersq</span>
wages <span class="co"># Display wages</span></code></pre></div>
<pre><code>##        wage schooling    sex exper expsq
## 1 134.23058        13 female     8    64
## 2 249.67744        13 female    11   121
## 3  53.56478        10 female    11   121</code></pre>
<p><br></p>
</div>
<div id="summarizing-data" class="section level3">
<h3>Summarizing data</h3>
<p>Summary statistics can also be easily created using the tidyverse function <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/mutate">summarize()</a></p>
<p>The <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/summarise">summarize</a> functions uses summary statistic functions in R to create a new summary tibble, with syntax largely identical to mutate().</p>
<p>Let’s try summarizing with the <a href="https://www.rdocumentation.org/packages/base/versions/3.4.3/topics/mean">mean()</a> summary statistic.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg_wage =</span> <span class="kw">mean</span>(wage))</code></pre></div>
<pre><code>##   avg_wage
## 1 145.8243</code></pre>
<p><br></p>
<div id="summary-statistics-functions-in-r" class="section level4">
<h4>Summary Statistics functions in R</h4>
<p>There are a number of summary statistics available in R, which can be used either with the <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/summarise">summarize()</a> command or outside of it:</p>
<p><strong>Measures of central tendency and spread:</strong></p>
<ul>
<li><a href="https://www.rdocumentation.org/packages/base/versions/3.4.3/topics/mean">mean()</a>, <a href="https://www.rdocumentation.org/packages/stats/versions/3.4.3/topics/median">median()</a>, <a href="https://www.rdocumentation.org/packages/stats/versions/3.4.3/topics/sd">sd()</a>, <a href="https://www.rdocumentation.org/packages/stats/versions/3.4.3/topics/cor">var()</a>, <a href="https://www.rdocumentation.org/packages/stats/versions/3.4.3/topics/quantile">quantile()</a>, <a href="https://www.rdocumentation.org/packages/stats/versions/3.4.3/topics/IQR">IQR()</a></li>
</ul>
<p><strong>Position:</strong></p>
<ul>
<li><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/nth">first()</a>, <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/nth">last()</a>, <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/nth">nth()</a>,</li>
</ul>
<p><strong>Count:</strong></p>
<ul>
<li><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/n">n()</a>, <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/n_distinct">n_distinct()</a>,</li>
</ul>
<p><br></p>
</div>
<div id="multiple-summary-variables" class="section level4">
<h4>Multiple summary variables</h4>
<p>Let’s look at an example of using multiple summary variables with a larger 50-observation sample for the <code>wages</code> data set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg.wage =</span> <span class="kw">mean</span>(wage), <span class="dt">sd.wage =</span> <span class="kw">sd</span>(wage), 
        <span class="dt">avg.exper =</span> <span class="kw">mean</span>(exper), <span class="dt">sd.exper =</span> <span class="kw">sd</span>(exper))</code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   avg.wage sd.wage avg.exper sd.exper
##      &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1    5942.  17526.      7.47     2.08</code></pre>
<p><br></p>
</div>
</div>
<div id="grouping-data" class="section level3">
<h3>Grouping data</h3>
<p>Creating summary statistics by group is another routine task. This is accommodated in the tidyverse using the <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/group_by">group_by()</a>.</p>
<ul>
<li>The arguments of group_by(), in addition to the data set, are simply the grouping variables separated by commas.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(sex) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg.wage =</span> <span class="kw">mean</span>(wage), <span class="dt">sd.wage =</span> <span class="kw">sd</span>(wage))</code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   sex    avg.wage sd.wage
##   &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 female    5473.  18883.
## 2 male      6410.  16711.</code></pre>
<p><br></p>
</div>
<div id="arranging-sorting-data" class="section level3">
<h3>Arranging (sorting) data</h3>
<p>If you want to sort your data by the values of a particular variable, you can easily do so as well with the <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/arrange">arrange()</a><br />
function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(exper)</code></pre></div>
<pre><code>## # A tibble: 3 x 4
##    wage schooling sex    exper
##   &lt;dbl&gt;     &lt;int&gt; &lt;fct&gt;  &lt;int&gt;
## 1  175.        12 female     5
## 2  103.        11 male       7
## 3 1411.        14 female     8</code></pre>
<p><strong>Not:</strong> <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/arrange">arrange()</a> sorts values in ascending order by default. If you want to sort in descending order, wrap the variable name inside <span style="color:blue"><strong>desc()</strong></span> in the function.</p>
<p><br></p>
</div>
<div id="sampling-from-data" class="section level3">
<h3>Sampling from data</h3>
<p>Creating a sample from a data set in R is made easy by two main function in R: <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/sample">sample_n</a> and <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/sample">sample_frac</a>.</p>
<p><strong>Syntax:</strong></p>
<ul>
<li><p>sample_n(data, size, replace = FALSE/TRUE)</p></li>
<li><p>sample_frac(data, size = 1, replace = FALSE/TRUE)</p></li>
</ul>
<p><br></p>
</div>
<div id="a-data-prep-example-with-fuel-economy-data" class="section level3">
<h3>A data prep example with fuel economy data</h3>
<p>Let’s use tidyverse data manipulation verbs to work through a practical data prep problem from start to finish.</p>
<p>For the problem, Let’s use fuel economy data again, but with half of the data set. The data comes from the <code>vehicles</code> data set in the <a href="https://cran.r-project.org/web/packages/fueleconomy/index.html">fueleconomy</a> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;fueleconomy&quot;) # Run only once</span>
<span class="kw">library</span>(fueleconomy)</code></pre></div>
<p>Now let’s look at how fuel efficiency has changed over time in the data set. Specifically, let’s create descriptive statistics of fuel efficiency by year for “normal” passenger vehicles (4-8 cylinders).</p>
<p><br></p>
<div id="whats-in-the-data-set" class="section level4">
<h4>What’s in the data set?</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(vehicles[<span class="dv">2</span><span class="op">:</span><span class="dv">12</span>], <span class="dt">width=</span><span class="dv">50</span>)</code></pre></div>
<pre><code>## Observations: 33,442
## Variables: 11
## $ make  &lt;chr&gt; &quot;AM General&quot;, &quot;AM General&quot;, &quot;AM G…
## $ model &lt;chr&gt; &quot;DJ Po Vehicle 2WD&quot;, &quot;DJ Po Vehic…
## $ year  &lt;int&gt; 1984, 1984, 1984, 1984, 1985, 198…
## $ class &lt;chr&gt; &quot;Special Purpose Vehicle 2WD&quot;, &quot;S…
## $ trans &lt;chr&gt; &quot;Automatic 3-spd&quot;, &quot;Automatic 3-s…
## $ drive &lt;chr&gt; &quot;2-Wheel Drive&quot;, &quot;2-Wheel Drive&quot;,…
## $ cyl   &lt;int&gt; 4, 4, 6, 6, 4, 6, 6, 4, 4, 6, 4, …
## $ displ &lt;dbl&gt; 2.5, 2.5, 4.2, 4.2, 2.5, 4.2, 3.8…
## $ fuel  &lt;chr&gt; &quot;Regular&quot;, &quot;Regular&quot;, &quot;Regular&quot;, …
## $ hwy   &lt;int&gt; 17, 17, 13, 13, 17, 13, 21, 26, 2…
## $ cty   &lt;int&gt; 18, 18, 13, 13, 16, 13, 14, 20, 2…</code></pre>
<p><br></p>
</div>
<div id="create-summary-tibble" class="section level4">
<h4>Create summary tibble</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">annual.mpg &lt;-<span class="st"> </span>vehicles <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_frac</span>(<span class="fl">0.5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(cyl <span class="op">%in%</span><span class="st"> </span><span class="dv">4</span><span class="op">:</span><span class="dv">8</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">hwy.avg =</span> <span class="kw">mean</span>(hwy), <span class="dt">hwy.sd =</span> <span class="kw">sd</span>(hwy),
            <span class="dt">city.avg =</span> <span class="kw">mean</span>(cty), <span class="dt">city.sd =</span> <span class="kw">sd</span>(cty)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(city.avg))</code></pre></div>
<p><strong>Note:</strong> Here I used <span style="color:blue"><strong>%in%</strong></span>, which works like <span style="color:blue"><strong>inrange</strong></span> in Stata. You could alternately write two inequalities to achieve the same thing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Print annual.mpg</span>
annual.mpg</code></pre></div>
<pre><code>## # A tibble: 32 x 5
##     year hwy.avg hwy.sd city.avg city.sd
##    &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1  2015    28.6   5.42     20.6    4.78
##  2  2014    27.8   6.44     20.4    5.76
##  3  2013    27.3   6.02     20.0    5.78
##  4  2012    26.3   5.83     19.2    5.21
##  5  2011    25.7   5.36     18.8    4.86
##  6  2010    25.3   4.90     18.4    4.38
##  7  1985    22.8   6.21     17.7    4.70
##  8  2009    24.2   4.54     17.6    3.92
##  9  1986    22.4   5.82     17.5    4.48
## 10  1997    23.6   5.11     17.2    3.76
## # … with 22 more rows</code></pre>
<p><br></p>
</div>
</div>
<div id="summarizing-a-data-set-with-the-summary-function" class="section level3">
<h3>Summarizing a data set with the summary() function</h3>
<p>Although the tidyverse <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/summarise">summarize()</a> function is more powerful, often you just a want a quick look at summary statistics for the whole data set.</p>
<ul>
<li>You can easily do this with the base R <a href="https://www.rdocumentation.org/packages/base/versions/3.4.3/topics/summary">summary()</a> function, which produces summaries not just for data sets, but also for other R output like the results of a regression.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(wages)</code></pre></div>
<pre><code>##       wage            schooling      sex         exper       
##  Min.   :    1.69   Min.   : 8   female:15   Min.   : 3.000  
##  1st Qu.:   44.07   1st Qu.:11   male  :15   1st Qu.: 6.250  
##  Median :  160.96   Median :12               Median : 7.500  
##  Mean   : 5941.66   Mean   :12               Mean   : 7.467  
##  3rd Qu.: 1519.01   3rd Qu.:13               3rd Qu.: 8.000  
##  Max.   :73659.06   Max.   :15               Max.   :13.000</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="cleaning-data" class="section level2">
<h2><strong>Cleaning data</strong></h2>
<div id="common-data-cleaning-tasks" class="section level3">
<h3>Common data cleaning tasks</h3>
<p>There are a few data cleaning tasks that are pervasive in empirical work:</p>
<ol style="list-style-type: decimal">
<li>Ensure columns have useful names</li>
<li>Recoding variable values</li>
<li>Addressing missing values</li>
</ol>
<p><br></p>
</div>
<div id="renaming-columns" class="section level3">
<h3>Renaming columns</h3>
<p>Renaming columns is easily accommodated with the tidyverse <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/select">rename()</a>  command.</p>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydataframe &lt;-<span class="st">  </span>mydataframe <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">NewVarName =</span> OldVarName)</code></pre></div>
<p>To see <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/select">rename()</a> in action, let’s go back to the <code>barro.lee.data</code> educational data set we imported earlier:</p>
<p><br></p>
<div id="renaming-columns-example" class="section level4">
<h4>Renaming columns example</h4>
<p>Let’s look at columns 1 and 7 through 9:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(barro.lee.data[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span><span class="op">:</span><span class="dv">9</span>)], <span class="dt">width =</span> <span class="dv">50</span>)</code></pre></div>
<pre><code>## Observations: 1,898
## Variables: 4
## $ BLcode &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ lu     &lt;dbl&gt; 80.68459, 81.05096, 82.61115, 80…
## $ lp     &lt;dbl&gt; 17.563400, 17.018442, 14.313748,…
## $ lpc    &lt;dbl&gt; 3.745905, 3.464397, 3.069391, 4.…</code></pre>
<p>See how these variable names are uninformative? Let’s use str() now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(barro.lee.data[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span><span class="op">:</span><span class="dv">9</span>)])</code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    1898 obs. of  4 variables:
##  $ BLcode: num  1 1 1 1 1 1 1 1 1 1 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;Country Code&quot;
##   ..- attr(*, &quot;format.stata&quot;)= chr &quot;%8.0g&quot;
##  $ lu    : num  80.7 81.1 82.6 80.9 73.6 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;Percentage of No Schooling&quot;
##   ..- attr(*, &quot;format.stata&quot;)= chr &quot;%7.2f&quot;
##  $ lp    : num  17.6 17 14.3 14.4 19.2 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;Percentage of Primary&quot;
##   ..- attr(*, &quot;format.stata&quot;)= chr &quot;%7.2f&quot;
##  $ lpc   : num  3.75 3.46 3.07 4.01 5.23 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;Percentage of Primary Complete&quot;
##   ..- attr(*, &quot;format.stata&quot;)= chr &quot;%7.2f&quot;</code></pre>
<p><strong>Although</strong> the column names here are uninformative, the imported SAS file included variable labels saved as attributes, which can be seen using the more verbose <a href="https://www.rdocumentation.org/packages/utils/versions/3.4.3/topics/str">str()</a> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">barro.lee.data &lt;-<span class="st"> </span>barro.lee.data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">countrycode =</span> BLcode, 
    <span class="dt">perc.noschool =</span> lu, 
    <span class="dt">perc.primary =</span> lp,
    <span class="dt">perc.primary.complete =</span> lpc)</code></pre></div>
<p>Now let’s look at the variable names again:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(barro.lee.data[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">7</span><span class="op">:</span><span class="dv">9</span>)], <span class="dt">width =</span> <span class="dv">50</span>)</code></pre></div>
<pre><code>## Observations: 1,898
## Variables: 4
## $ countrycode           &lt;dbl&gt; 1, 1, 1, 1, 1, 1,…
## $ perc.noschool         &lt;dbl&gt; 80.68459, 81.0509…
## $ perc.primary          &lt;dbl&gt; 17.563400, 17.018…
## $ perc.primary.complete &lt;dbl&gt; 3.745905, 3.46439…</code></pre>
<p><br></p>
</div>
</div>
<div id="recoding-variables" class="section level3">
<h3>Recoding variables</h3>
<p>Along with renaming variables, recoding variables is another integral part of data wrangling.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="st">&quot;sex&quot;</span>] <span class="co"># Look at sex column</span></code></pre></div>
<pre><code>## # A tibble: 4 x 1
##   sex   
##   &lt;fct&gt; 
## 1 female
## 2 female
## 3 male  
## 4 male</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages<span class="op">$</span>sex &lt;-<span class="st"> </span>wages<span class="op">$</span>sex <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">recode</span>(<span class="st">&quot;male&quot;</span>=<span class="dv">0</span>, 
                            <span class="st">&quot;female&quot;</span>=<span class="dv">1</span>) <span class="co"># recode</span>
wages[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="st">&quot;sex&quot;</span>] <span class="co"># Look at sex column</span></code></pre></div>
<pre><code>## # A tibble: 4 x 1
##     sex
##   &lt;dbl&gt;
## 1     1
## 2     1
## 3     0
## 4     0</code></pre>
<p><br></p>
</div>
<div id="missing-values" class="section level3">
<h3>Missing Values</h3>
<p>Another problem characteristic of observational data is missing data. In R, the way to represent missing data is with the value <span style="color:blue"><strong>NA</strong></span>.</p>
<ul>
<li>You can recode missing value that <em>should be</em> NA but are code using a different schema either by using brackets, or the tidyverse <a href="http://dplyr.tidyverse.org/reference/na_if.html">na_if()</a> function.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Replace 99-denoted missing data with NA
<span class="co"># bracket method</span>
wages[wages<span class="op">$</span>schooling<span class="op">==</span><span class="dv">99</span>,] &lt;-<span class="st"> </span><span class="ot">NA</span>  
<span class="co"># tidyverse method</span>
wages<span class="op">$</span>schooling &lt;-<span class="st"> </span>wages<span class="op">$</span>schooling <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">na_if</span>(<span class="dv">99</span>) </code></pre></div>
<p>You can check for (correctly-coded) missing-values using the <a href="https://www.rdocumentation.org/packages/base/versions/3.4.3/topics/NA">is.na()</a> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Missing 
wages[<span class="kw">is.na</span>(wages<span class="op">$</span>wage),]</code></pre></div>
<pre><code>## # A tibble: 3 x 4
##    wage schooling   sex exper
##   &lt;dbl&gt;     &lt;int&gt; &lt;dbl&gt; &lt;int&gt;
## 1    NA        14     1     8
## 2    NA        11     0     8
## 3    NA        10     0     8</code></pre>
<p><strong>Note:</strong> R does not naturally support multiple types of missingness like other languages, although it’s possible to use the <a href="https://cran.r-project.org/web/packages/sjmisc/index.html">sjmisc</a> package to do this.</p>
<p><br> <br></p>
</div>
</div>
<div id="tidy-data" class="section level2">
<h2><strong>Tidy data</strong></h2>
<div id="principles-of-tidy-data" class="section level3">
<h3>Principles of tidy data</h3>
<p>Rules for tidy data (from <em>R for Data Science</em>):</p>
<ol style="list-style-type: decimal">
<li>Each variable must have its own column.</li>
<li>Each observation must have its own row.</li>
<li>Each value must have its own cell.</li>
</ol>
<p><br></p>
</div>
<div id="tidy-data-tools-in-the-tidyverse" class="section level3">
<h3>Tidy data tools in the tidyverse</h3>
<p>There two main tidyverse verbs for making data tidy are:</p>
<p><strong><a href="https://www.rdocumentation.org/packages/tidyr/versions/0.8.0/topics/gather">gather()</a></strong>: reduces variable values are spread over multiples columns into a single column.</p>
<p><strong><a href="https://www.rdocumentation.org/packages/tidyr/versions/0.8.0/topics/spread">spread()</a></strong>: when multiple variables values are stored in the same columns, moves each variable into it’s own column.</p>
<p><br></p>
</div>
<div id="gathering-data" class="section level3">
<h3>Gathering data</h3>
<p>If values for a single variable are spread across multiple columns (e.g. income for different years), <a href="https://www.rdocumentation.org/packages/tidyr/versions/0.8.0/topics/gather">gather</a> moves this into single “values” column with a “key” column to identify what the different columns differentiated.</p>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gather</span>(data, key, value, columnstocombine)</code></pre></div>
<p><br></p>
<div id="gather-example" class="section level4">
<h4>Gather example</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">earnings.panel</code></pre></div>
<pre><code>## # A tibble: 7 x 3
##   person  y1999 y2000
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 Elsa       10    15
## 2 Mickey     20    28
## 3 Ariel      17    21
## 4 Gaston     19    19
## 5 Jasmine    32    35
## 6 Peter      22    29
## 7 Alice      11    15</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">earnings.panel &lt;-<span class="st"> </span>earnings.panel <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span><span class="st">&quot;year&quot;</span>, <span class="dt">value=</span><span class="st">&quot;wage&quot;</span>,y1999<span class="op">:</span>y2000)
earnings.panel</code></pre></div>
<pre><code>## # A tibble: 14 x 3
##    person  year   wage
##    &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt;
##  1 Elsa    y1999    10
##  2 Mickey  y1999    20
##  3 Ariel   y1999    17
##  4 Gaston  y1999    19
##  5 Jasmine y1999    32
##  6 Peter   y1999    22
##  7 Alice   y1999    11
##  8 Elsa    y2000    15
##  9 Mickey  y2000    28
## 10 Ariel   y2000    21
## 11 Gaston  y2000    19
## 12 Jasmine y2000    35
## 13 Peter   y2000    29
## 14 Alice   y2000    15</code></pre>
<p><br></p>
</div>
</div>
<div id="spreading-data" class="section level3">
<h3>Spreading data</h3>
<p>Spread tackles the other major problem - that often times (particularly in longitudinal data) many variables are condensed into just a “key” (or indicator) column and a value column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages2</code></pre></div>
<pre><code>##     person indicator      values
## 1     Elsa      wage          NA
## 2   Mickey      wage  174.932480
## 3    Ariel      wage  102.668810
## 4   Gaston      wage    1.690623
## 5  Jasmine      wage    2.166231
## 6    Peter      wage 1192.371925
## 7    Alice      wage   83.363705
## 8     Elsa      wage          NA
## 9   Mickey      wage  174.932480
## 10   Ariel      wage  102.668810
## 11  Gaston      wage    1.690623
## 12 Jasmine      wage    2.166231
## 13   Peter      wage 1192.371925
## 14   Alice      wage   83.363705
## 15    Elsa schooling   14.000000
## 16  Mickey schooling   12.000000
## 17   Ariel schooling   11.000000
## 18  Gaston schooling   11.000000
## 19 Jasmine schooling   14.000000
## 20   Peter schooling   12.000000
## 21   Alice schooling   11.000000
## 22    Elsa schooling   14.000000
## 23  Mickey schooling   12.000000
## 24   Ariel schooling   11.000000
## 25  Gaston schooling   11.000000
## 26 Jasmine schooling   14.000000
## 27   Peter schooling   12.000000
## 28   Alice schooling   11.000000
## 29    Elsa     exper    8.000000
## 30  Mickey     exper    5.000000
## 31   Ariel     exper    7.000000
## 32  Gaston     exper    8.000000
## 33 Jasmine     exper   10.000000
## 34   Peter     exper    8.000000
## 35   Alice     exper    6.000000
## 36    Elsa     exper    8.000000
## 37  Mickey     exper    5.000000
## 38   Ariel     exper    7.000000
## 39  Gaston     exper    8.000000
## 40 Jasmine     exper   10.000000
## 41   Peter     exper    8.000000
## 42   Alice     exper    6.000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">spread</span>(<span class="st">&quot;indicator&quot;</span>, <span class="st">&quot;values&quot;</span>)</code></pre></div>
<pre><code>##     person        wage schooling exper
## 1     Elsa          NA        14     8
## 2   Mickey  174.932480        12     5
## 3    Ariel  102.668810        11     7
## 4   Gaston    1.690623        11     8
## 5  Jasmine    2.166231        14    10
## 6    Peter 1192.371925        12     8
## 7    Alice   83.363705        11     6
## 8     Elsa          NA        14     8
## 9   Mickey  174.932480        12     5
## 10   Ariel  102.668810        11     7
## 11  Gaston    1.690623        11     8
## 12 Jasmine    2.166231        14    10
## 13   Peter 1192.371925        12     8
## 14   Alice   83.363705        11     6</code></pre>
<p><br> <br></p>
</div>
</div>
</div>
<div id="loops-conditionals-joins-and-more" class="section level1">
<h1><strong>Loops, conditionals, joins, and more</strong></h1>
<p><br></p>
<div id="revisiting-basics" class="section level2">
<h2><strong>Revisiting basics</strong></h2>
<div id="assignment-operator" class="section level3">
<h3>Assignment Operator</h3>
<p>So far, when changing a data object, we have always been a bit repetitive:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydataframe &lt;-<span class="st">  </span>mydataframe <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">NewVarName =</span> OldVarName)</code></pre></div>
<p>Along with the standard pipe <strong>(%&gt;%)</strong>, by loading the <a href="https://magrittr.tidyverse.org/">magrittr</a> package, you can also use the so-called “assignment pipe” <strong>(%&lt;&gt;%)</strong>.</p>
<ul>
<li>The above rename with the assignment pipe appears as:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mydataframe <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">NewVarName =</span> OldVarName)</code></pre></div>
<p><br></p>
</div>
<div id="lists" class="section level3">
<h3>Lists</h3>
<p>Another subtlety glossed over so far are <em>lists.</em></p>
<ul>
<li><p>As mentioned in module 1, vectors come in two forms: atomic vectors (with a single data type) and lists (with heterogenous data types).</p></li>
<li><p>Lists can take as inputs not only single-valued elements, but also vectors or data frames.</p></li>
<li><p>Creating a list from other objects is done with the <strong>list()</strong> function. The syntax of list is:</p></li>
</ul>
<p><br></p>
<div id="list-creation-example" class="section level4">
<h4>List Creation Example</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages_df; date_df; description</code></pre></div>
<pre><code>##        wage schooling    sex exper
## 1 134.23058        13 female     8
## 2 249.67744        13 female    11
## 3  53.56478        10 female    11</code></pre>
<pre><code>##   month year
## 1   Jan 2017
## 2   Feb 2018
## 3 March 2019</code></pre>
<pre><code>## [1] &quot;Data on wages and date information.&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mylist &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">wages =</span> wages_df, <span class="dt">dates =</span> date_df, description)</code></pre></div>
<p>Where <em>wages_df</em> and <em>date_df</em> are data frames and description is a single character element.</p>
<p><br></p>
</div>
<div id="list-creation-example-ctd" class="section level4">
<h4>List Creation Example ctd</h4>
<div class="figure">
<img src="assets/mylist.png" />

</div>
<p><br></p>
</div>
</div>
<div id="subsetting-a-list" class="section level3">
<h3>Subsetting a list</h3>
<ul>
<li><p>To subset a vector/matrix/data frame, one uses single brackets, eg <em>mydf[,]</em>.</p></li>
<li><p>To refer to an object of a list, use double brackets.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mylist[[<span class="dv">3</span>]]</code></pre></div>
<pre><code>## [1] &quot;Data on wages and date information.&quot;</code></pre>
<p><strong>Note:</strong> The function <strong>list()</strong> does not take transfer the names of the data frames, so you will need to either subset by position or assign names to the list objects.</p>
<p><br></p>
</div>
<div id="extracting-a-list" class="section level3">
<h3>Extracting a list</h3>
<p>An easy way of extracting an object from a list is with the <strong>extract2()</strong> function from <a href="https://magrittr.tidyverse.org/">magrittr</a>. This allows you to extra a given list object by name or position.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_data &lt;-<span class="st"> </span>mylist <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">extract2</span>(<span class="dv">1</span>)
wage_data</code></pre></div>
<pre><code>##        wage schooling    sex exper
## 1 134.23058        13 female     8
## 2 249.67744        13 female    11
## 3  53.56478        10 female    11</code></pre>
</div>
<div id="the-unlist-function" class="section level3">
<h3>The unlist function</h3>
<p>Instead of creating more complicated data objects, sometimes formatted as list into a simple (atomic) vector. The <strong>unlist()</strong> function does this.</p>
<p><strong>Example:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simple_list &lt;-<span class="kw">list</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)
<span class="kw">str</span>(simple_list)</code></pre></div>
<pre><code>## List of 4
##  $ : num 1
##  $ : num 2
##  $ : num 3
##  $ : num 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simple_list <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</code></pre></div>
<pre><code>##  num [1:4] 1 2 3 4</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="iteration" class="section level2">
<h2><strong>Iteration</strong></h2>
<div id="for-loops" class="section level3">
<h3>For loops</h3>
<p>For tasks that you want to iterate over multiple data frames/variables/elements, you may want to think about creating a <strong>loop</strong>.</p>
<ul>
<li>A loop performs a function/functions multiple times, across either a list of objects or a set of index values.</li>
</ul>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(indexname <span class="cf">in</span> range) {
  do stuff
}</code></pre></div>
<p><br></p>
<div id="for-loop-across-numeric-values" class="section level4">
<h4>For loop across numeric values</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>){
  <span class="kw">print</span>(i<span class="op">^</span><span class="dv">2</span>)
}</code></pre></div>
<pre><code>## [1] 1
## [1] 4
## [1] 9
## [1] 16</code></pre>
<p><br></p>
</div>
<div id="for-loop-across-named-elements" class="section level4">
<h4>For loop across named elements</h4>
<p>You can also loop over elements instead of values.</p>
<ul>
<li>In the last module exercises, you had to convert the type of many variables. Here’s one way you could do that with a loop:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nlsy97 &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;./data/nlsy97.rds&quot;</span>)
factor.vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;personid&quot;</span>,<span class="st">&quot;year&quot;</span>,<span class="st">&quot;sex&quot;</span>,<span class="st">&quot;race&quot;</span>,<span class="st">&quot;region&quot;</span>,<span class="st">&quot;schooltype&quot;</span>)
  <span class="cf">for</span> (i <span class="cf">in</span> factor.vars){
   nlsy97[,i] <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.factor</span>()
  }</code></pre></div>
<p><br> <br></p>
</div>
</div>
<div id="the-map-function" class="section level3">
<h3>The map() function</h3>
<p>For iterations over vectors and dataframes, the <a href="https://www.rdocumentation.org/packages/purrr/versions/0.2.4/topics/map">map()</a> function is a great alternative to the for loop.</p>
<p>Map functions take a user-supplied function and iterate it over:</p>
<ul>
<li><p>Elements for a vector</p></li>
<li><p>Objects of a list</p></li>
<li><p>Columns of a data frame</p></li>
</ul>
<p>Map functions are much simpler to write than loops and are also generally a good bit faster.</p>
<ul>
<li><strong><em>Sidenote</em></strong>: Map is a part of the tidyverse collection of packages. In base R, the <a href="https://www.rdocumentation.org/packages/base/versions/3.4.3/topics/apply">apply()</a> family of functions does roughly the same thing, but <a href="https://www.rdocumentation.org/packages/purrr/versions/0.2.4/topics/map">map()</a> simplifies and improves this task.</li>
</ul>
<p><br></p>
<div id="using-the-map-function" class="section level4">
<h4>Using the map() function</h4>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(data, fxn, option1, option2...)</code></pre></div>
<p><strong>Example:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nlsy97[,factor.vars] <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">map</span>(as.factor) </code></pre></div>
<p><br></p>
</div>
<div id="using-class-specific-map-variants" class="section level4">
<h4>Using class-specific map variants</h4>
<p>There are multiple map variants that enforce a given data type on results. You should use these whenever you want output of a certain class.</p>
<ul>
<li><p>map_lgl for logical vector</p></li>
<li><p>map_dbl for numeric vector</p></li>
<li><p>map_chr for character vector</p></li>
<li><p>map_df for a data frame</p></li>
</ul>
<p><br></p>
</div>
<div id="example-of-difference-with-class-specific-map-variants" class="section level4">
<h4>Example of difference with class-specific map variants</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nlsy.sub &lt;-<span class="st"> </span>nlsy97 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(parentincome, motheredyrs, gpa)
nlsy.sub <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(IQR, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## parentincome  motheredyrs          gpa 
##   55947.2500       3.0000       2.8075</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nlsy.sub <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(IQR, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## $parentincome
## [1] 55947.25
## 
## $motheredyrs
## [1] 3
## 
## $gpa
## [1] 2.8075</code></pre>
<p><br></p>
</div>
<div id="using-map-with-anonymous-functions" class="section level4">
<h4>Using map() with anonymous functions</h4>
<p><strong><a href="https://www.rdocumentation.org/packages/purrr/versions/0.2.4/topics/map">map()</a></strong> works with not only predefined functions, but also “anonymous functions”— unnamed functions defined inside of map().</p>
<ul>
<li>Suppose I want the z-standardized values of the variables from the previous example:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create Z Transform</span>
ztransform &lt;-<span class="st"> </span><span class="kw">map_df</span>(nlsy.sub, <span class="cf">function</span>(x) 
  (x <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x,  <span class="dt">na.rm=</span><span class="ot">TRUE</span>)) <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
  )

### Did it work?

<span class="co"># Means</span>
<span class="kw">map_dbl</span>(ztransform, <span class="cf">function</span>(x) 
  <span class="kw">round</span>(<span class="kw">mean</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),<span class="dv">10</span>))</code></pre></div>
<pre><code>## parentincome  motheredyrs          gpa 
##            0            0            0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Standard deviations</span>
<span class="kw">map_dbl</span>(ztransform, <span class="cf">function</span>(x) 
  <span class="kw">round</span>(<span class="kw">sd</span>(x, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),<span class="dv">10</span>))</code></pre></div>
<pre><code>## parentincome  motheredyrs          gpa 
##            1            1            1</code></pre>
<p><br> <br></p>
</div>
</div>
</div>
<div id="conditional-statements" class="section level2">
<h2><strong>Conditional Statements</strong></h2>
<div id="if-statements" class="section level3">
<h3>If statements</h3>
<p>“If statements” are also a useful part of programming, either in conjunction with iteration or seperately.</p>
<ul>
<li>An if statement performs operations only if a specified condition is met.
<ul>
<li>An important thing to know, however, is that if statements evaluate conditions of length one (ie non-vector arguments).</li>
<li>We will cover a vector equivalent to the if statement shortly.</li>
</ul></li>
</ul>
<p><strong>Syntax</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span>(condition){
     do stuff
    }</code></pre></div>
<p><br></p>
<div id="example-of-an-if-statement" class="section level4">
<h4>Example of an if statement</h4>
<ul>
<li><p>In the for loop example, the loop was indexed over only the columns of indicator codes.</p></li>
<li><p>Equally, the loop could be done over all columns with an if-statement to change only the indicator codes.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">colnames</span>(nlsy97)){
  
  <span class="cf">if</span>(j <span class="op">%in%</span><span class="st"> </span>factor.vars){
      nlsy97[,j] <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.factor</span>()
  }
}</code></pre></div>
<p><br></p>
</div>
<div id="multiple-conditions" class="section level4">
<h4>Multiple conditions</h4>
<p>You can encompass several conditions using the <span style="color:blue"><strong>else if</strong></span> and catch-all <span style="color:blue"><strong>else</strong></span> control statements.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (condition1) {
do stuff
} <span class="cf">else</span> <span class="cf">if</span> (condition2) {
do other stuff
} <span class="cf">else</span> {
do other other stuff
}</code></pre></div>
<p><br></p>
</div>
</div>
<div id="vectorized-if-statements" class="section level3">
<h3>Vectorized if statements</h3>
<ul>
<li><p>As alluded to earlier, if statements can’t test-and-do for vectors, but only single-valued objects.</p></li>
<li><p>Most of the time, you probably want to use conditional statements on vectors. The vector equivalent to the if statement is <a href="https://www.rdocumentation.org/packages/base/versions/3.4.3/topics/ifelse">ifelse()</a></p></li>
</ul>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ifelse</span>(condition, true_statement, false_statement)</code></pre></div>
<p>The statements returned can be simple values, but they can also be functions or even further conditions. You can easily nest multiple <a href="https://www.rdocumentation.org/packages/base/versions/3.4.3/topics/ifelse">ifelses</a> if desired.</p>
<p><br></p>
<div id="an-ifelse-example" class="section level4">
<h4>An ifelse example</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> numbers &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>, <span class="dv">7</span>); numbers</code></pre></div>
<pre><code>## [1] 29 11 13 22 27 12 30</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ifelse</span>(numbers <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="st">&quot;even&quot;</span>,<span class="st">&quot;odd&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;odd&quot;  &quot;odd&quot;  &quot;odd&quot;  &quot;even&quot; &quot;odd&quot;  &quot;even&quot; &quot;even&quot;</code></pre>
<p><strong>Note:</strong> What if we tried a normal if statement instead?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="cf">if</span>(numbers <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){
   <span class="kw">print</span>(<span class="st">&quot;even&quot;</span>)} <span class="cf">else</span>{
     <span class="kw">print</span>(<span class="st">&quot;odd&quot;</span>)}</code></pre></div>
<pre><code>## [1] &quot;odd&quot;</code></pre>
<p><br></p>
</div>
<div id="multiple-vectorized-if-statements" class="section level4">
<h4>Multiple vectorized if statements</h4>
<p>A better alternative to multiple nested <code>ifelse</code> statements is the tidyverse <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/case_when">case_when</a> function.</p>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">case_when</span>(
  condition1 <span class="op">~</span><span class="st"> </span>statement1,
  condition2 <span class="op">~</span><span class="st"> </span>statement2,
  condition3 <span class="op">~</span><span class="st"> </span>statement3,
)</code></pre></div>
<p><br></p>
</div>
<div id="a-case_when-example" class="section level4">
<h4>A case_when example</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nums_df &lt;-<span class="st"> </span>numbers <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">interval =</span> <span class="kw">case_when</span>(
  (numbers <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>numbers <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>) <span class="op">~</span><span class="st"> &quot;1-10&quot;</span>,
  (numbers <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span> <span class="op">&amp;</span><span class="st"> </span>numbers <span class="op">&lt;=</span><span class="st"> </span><span class="dv">20</span>) <span class="op">~</span><span class="st"> &quot;10-20&quot;</span>,
  (numbers <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span> <span class="op">&amp;</span><span class="st"> </span>numbers <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>) <span class="op">~</span><span class="st"> &quot;20-30&quot;</span>))
nums_df[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,]</code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   value interval
##   &lt;int&gt; &lt;chr&gt;   
## 1    29 20-30   
## 2    11 10-20   
## 3    13 10-20   
## 4    22 20-30</code></pre>
<p><br> <br></p>
</div>
</div>
</div>
<div id="functions" class="section level2">
<h2><strong>Functions</strong></h2>
<div id="when-you-should-write-a-function" class="section level4">
<h4>When you should write a function</h4>
<p>If you find yourself performing the same specific steps more than a couple of times (perhaps with slight variations), then you should consider writing a function.</p>
<p>A function can serve essentially as a wrapper for a series of steps, where you define generalized inputs/arguments.</p>
<p><br></p>
</div>
<div id="writing-a-function" class="section level4">
<h4>Writing a function</h4>
<p><strong>Ingredients:</strong></p>
<ul>
<li><p>Function name</p></li>
<li><p>Arguments</p></li>
<li><p>Function body</p></li>
</ul>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">function_name &lt;-<span class="st"> </span><span class="cf">function</span>(arg1, arg2, ...){
  do stuff
}</code></pre></div>
<p><br></p>
</div>
<div id="function-example" class="section level4">
<h4>Function example</h4>
<p>Let’s turn the calculation of even or odd that was completed earlier into a function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Make odd function</span>
odd &lt;-<span class="st"> </span><span class="cf">function</span>(obj){
   <span class="kw">ifelse</span>(obj <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="st">&quot;even&quot;</span>,<span class="st">&quot;odd&quot;</span>)
}</code></pre></div>
<p><strong><em>Notice</em></strong> that <em>obj</em> here is a descriptive placeholder name for the data object to be supplied as an argument for the function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">odd</span>(numbers)</code></pre></div>
<pre><code>## [1] &quot;odd&quot;  &quot;odd&quot;  &quot;odd&quot;  &quot;even&quot; &quot;odd&quot;  &quot;even&quot; &quot;even&quot;</code></pre>
<p><br></p>
</div>
<div id="rstudios-extract-function" class="section level4">
<h4>RStudio’s “Extract Function”</h4>
<p>A useful way of writing simple functions when you’ve already written the code for a specific instance is to use RStudio’s <em>Extract Function</em> option, which is available from the code menu.</p>
<ul>
<li><em>Extract function</em> will take the code chunk and treat any data objects referenced but not created within the chunk as function arguments.</li>
</ul>
<p><br> <br></p>
</div>
</div>
<div id="joins" class="section level2">
<h2><strong>Joins</strong></h2>
<div id="merging-data" class="section level3">
<h3>Merging data</h3>
<p><em>Shifting gears from programming…</em></p>
<p>Another staple task in applied work is combining data from multiple data sets. The tidyverse set of packages includes several useful types of merges (or “joins”):</p>
<ul>
<li><p><strong><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/join">left_join()</a></strong> Appends columns from dataset B to dataset A, keeping all observations in dataset A.</p></li>
<li><p><strong><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/join">inner_join()</a></strong> Appends columns together, keeping only observations that appear in both dataset A and B.</p></li>
<li><p><strong><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/join">semi_join()</a></strong> Keeps only columns of dataset A for observations that appear in both dataset A and B.</p></li>
<li><p><strong><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/join">anti_join()</a></strong> Keeps only columns of dataset A for    observations that <em>do not</em> appear in both dataset A and B.</p></li>
</ul>
<p><br></p>
</div>
<div id="joining-using-keys" class="section level3">
<h3>Joining using keys</h3>
<p>The starting point for any merge is to enumerate the column or columns that uniquely identify observations in the dataset.</p>
<ul>
<li><p>For cross-sectional data, this might be a personal identifier or (for aggregate data) something like municipality, state, country, etc.</p></li>
<li><p>For panel data, this will typically be both the personal/group identifier and a timing variable, for example Sweden in 2015 in a cross-country analysis.</p></li>
</ul>
<p><br></p>
<div id="mismatched-key-names-across-datasets" class="section level4">
<h4>Mismatched key names across datasets</h4>
<p>Sometimes the names of the key variables are different across datasets.</p>
<ul>
<li><p>You could of course rename the key variables to be consistent.</p></li>
<li><p>But mismatched key names are easily handled by the tidyverse join functions.</p></li>
</ul>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">join_function</span>(x, y, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;x_name&quot;</span> =<span class="st"> &quot;y_name&quot;</span>))</code></pre></div>
<p><br></p>
</div>
</div>
<div id="left_join" class="section level3">
<h3>left_join</h3>
<p>The <strong><a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/join">left_join()</a></strong> is the most frequent type of join, corresponding to a standard <strong>merge</strong> in Stata.</p>
<ul>
<li>left_join simply appends additional variables from a second dataset to a main dataset, keeping all the observations (rows) of the first dataset.</li>
</ul>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">left_join</span>(x, y, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>)</code></pre></div>
<p>If the key is muliple columns, use <span style="color:blue"><strong>c()</strong></span> to list them.</p>
<p><br></p>
<div id="left_join-example" class="section level4">
<h4>left_join example</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Look at the datasets</span>
earnings</code></pre></div>
<pre><code>##   person_id wage
## 1       001  150
## 2       002   90
## 3       003  270</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">educ</code></pre></div>
<pre><code>##   person_id schooling
## 1       001        12
## 2       003         8
## 3       004        16</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Combine data</span>
combined_data &lt;-<span class="st"> </span><span class="kw">left_join</span>(earnings, educ, 
                           <span class="dt">by=</span><span class="st">&quot;person_id&quot;</span>)

<span class="co"># Print data</span>
combined_data</code></pre></div>
<pre><code>##   person_id wage schooling
## 1       001  150        12
## 2       002   90        NA
## 3       003  270         8</code></pre>
<p><strong><em>Notice</em></strong> that schooling is equal to NA for person ‘002’ because    that person does not appear in the <em>educ</em> dataset.</p>
<p><br></p>
</div>
</div>
<div id="inner_join" class="section level3">
<h3>inner_join</h3>
<p>If you want to combine the variables of two data sets, but only keep the observations present in both datasets, use the <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/join">inner_join()</a> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">combined_data &lt;-<span class="st"> </span><span class="kw">inner_join</span>(earnings, educ, 
                            <span class="dt">by=</span><span class="st">&quot;person_id&quot;</span>)
combined_data</code></pre></div>
<pre><code>##   person_id wage schooling
## 1       001  150        12
## 2       003  270         8</code></pre>
<p><br></p>
</div>
<div id="semi_join" class="section level3">
<h3>semi_join</h3>
<p>To keep using only the variables in the first dataset, but where observations in the first dataset are matched in the second dataset, use <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/join">semi_join()</a>.</p>
<ul>
<li>semi_join is an example of a <em>filtering join</em>. Filtering joins don’t add new columns, but instead just filter observations for matches in a second dataset.</li>
<li>left_join and inner_join are instead known as <em>mutating joins</em>, because new variables are added to the dataset.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filtered_data &lt;-<span class="st"> </span><span class="kw">semi_join</span>(earnings, educ, <span class="dt">by=</span><span class="st">&quot;person_id&quot;</span>)
filtered_data</code></pre></div>
<pre><code>##   person_id wage
## 1       001  150
## 2       003  270</code></pre>
<p><br></p>
</div>
<div id="anti_join" class="section level3">
<h3>anti_join</h3>
<p>Another <em>filtering join</em> is <a href="https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/join">anti_join()</a>, which filters for observations that are <em>not matched</em> in a second dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filtered_data &lt;-<span class="st"> </span><span class="kw">anti_join</span>(earnings, educ, 
                           <span class="dt">by=</span><span class="st">&quot;person_id&quot;</span>)
filtered_data</code></pre></div>
<pre><code>##   person_id wage
## 1       002   90</code></pre>
<p>There are still other join types, which you can read about <a href="http://dplyr.tidyverse.org/reference/join.html">here</a>.</p>
<p><br></p>
</div>
<div id="appending-data" class="section level3">
<h3>Appending data</h3>
<p>Finally, instead of joining different datasets for the same individuals, sometimes you want to join together files that are for different individuals within the same dataset.</p>
<ul>
<li>When join data where the variables for each dataset are the same, but the observations are different, this is called <em>appending</em> data.</li>
</ul>
<p>The function for appending data in the tidyverse is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bind_rows</span>(<span class="kw">list</span>(dataframe1,dataframe2,...))</code></pre></div>
<p><br> <br></p>
</div>
</div>
<div id="manipulating-text" class="section level2">
<h2><strong>Manipulating text</strong></h2>
<div id="concatenating-strings" class="section level3">
<h3>Concatenating strings</h3>
<p>The last type of data preparation that we will cover in this course is manipulating string data.</p>
<ul>
<li><p>The simplest string manipulation may be concatenating (ie combining) strings.</p>
<ul>
<li>A great function for combining string in R is the <strong>glue()</strong> function, part of the Tiydverse <a href="https://glue.tidyverse.org/reference/glue.html">glue package</a>.</li>
</ul></li>
<li><p>The glue function lets you reference variable values inside of text strings by writing the variable in curly brackets <strong>{}</strong> inside of the string.</p></li>
</ul>
<p><br></p>
<div id="glue-example" class="section level4">
<h4>Glue Example</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">date_df <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(
   <span class="dt">say.month =</span> <span class="kw">glue</span>(<span class="st">&quot;The month is {month}&quot;</span>),
   <span class="dt">mo.yr =</span> <span class="kw">glue</span>(<span class="st">&quot;{month} {year}&quot;</span>)
 )
date_df</code></pre></div>
<pre><code>##   month year          say.month      mo.yr
## 1   Jan 2017   The month is Jan   Jan 2017
## 2   Feb 2018   The month is Feb   Feb 2018
## 3 March 2019 The month is March March 2019</code></pre>
<p><br></p>
</div>
<div id="glue-example-2" class="section level4">
<h4>Glue Example 2</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">numbers &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)
<span class="cf">for</span> (i <span class="cf">in</span> numbers){
  <span class="kw">print</span>(<span class="kw">glue</span>(<span class="st">&quot;The magic number is {i}&quot;</span>))
}</code></pre></div>
<pre><code>## The magic number is 1
## The magic number is 2
## The magic number is 3</code></pre>
<p><br></p>
</div>
</div>
<div id="extracting-and-replacing-parts-of-a-string" class="section level3">
<h3>Extracting and replacing parts of a string</h3>
<p>Other common string manipulating tasks include extracting or replacing parts of a string. These are accomplished via the <strong>str_extract()</strong> and <strong>str_replace()</strong> from the Tidyverse <a href="https://stringr.tidyverse.org/index.html">stringr</a> package.</p>
<ul>
<li>We saw examples of these two functions in the last seminar exercise:</li>
</ul>
<p>The arguments for each function are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_extract</span>(string_object, <span class="st">&quot;pattern_to_match&quot;</span>)
<span class="kw">str_replace</span>(string_object, <span class="st">&quot;pattern_to_match&quot;</span>,<span class="st">&quot;replacement_text&quot;</span>)</code></pre></div>
<p>By default, both function operate on the first match of the specified pattern. To operate on <em>all</em> matchs, add “_all&quot; to the function name, as in:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_extract_all</span>(string_object, <span class="st">&quot;pattern_to_match&quot;</span>)</code></pre></div>
<p><br></p>
<div id="extract-and-replace-example" class="section level4">
<h4>Extract and replace example</h4>
<p>In the last seminar, we created a “year” column from years indicated in the “variable” column text via the expression:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nlsy97<span class="op">$</span>year &lt;-<span class="st"> </span><span class="kw">str_extract</span>(nlsy97<span class="op">$</span>variable, <span class="st">&quot;[0-9]+&quot;</span>)</code></pre></div>
<p>After creating the “year” column, we then removed the year values from the values of the “variable” column by replacing these numbers with an empty string.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nlsy97<span class="op">$</span>variable &lt;-<span class="st"> </span><span class="kw">str_replace</span>(nlsy97<span class="op">$</span>variable, <span class="st">&quot;[0-9]+&quot;</span>,<span class="st">&quot;&quot;</span>)</code></pre></div>
<p><br></p>
</div>
</div>
<div id="trimming-a-string" class="section level3">
<h3>Trimming a string</h3>
<p>When working with formatted text, a third common task is to remove extra spaces before or after the string text.</p>
<ul>
<li>This is done with the <strong>str_trim()</strong> function. The syntax is:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_trim</span>(string, <span class="dt">side =</span> <span class="st">&quot;left&quot;</span><span class="op">/</span><span class="st">&quot;right&quot;</span><span class="op">/</span><span class="st">&quot;both&quot;</span>)</code></pre></div>
<p>Note, when printing a string, any formatting characters are shown. To view how the string looks formatted, use the <strong>ViewLines()</strong> function.</p>
<p><br></p>
</div>
<div id="using-regular-expressions-with-strings" class="section level3">
<h3>Using regular expressions with strings</h3>
<p>Often we want to modify strings based on a pattern rather than an exact expression, as seen with the <strong>str_extract()</strong> and <strong>str_replace()</strong> examples.</p>
<ul>
<li><p>Patterns are specified in R (as in many other languages) using a syntax known as “regular expressions” or <em>regex</em>.</p></li>
<li><p>Today, we will very briefly introduce some regular expressions.</p></li>
</ul>
<p><br></p>
</div>
<div id="common-expressions" class="section level3">
<h3>Common Expressions</h3>
<ul>
<li>To match “one of” several elements, refer to them in square brackets, eg: [abc]</li>
<li>To match one of a range of values, use a hyphen to indicate the range: e.g. [a-z],[0-9]</li>
<li>To match either of a couple of patterns/expressions, use the OR operator, eg: “2017|2018”</li>
<li><p>There are also abbreviation for one of specific types of characters</p>
<ul>
<li><p>eg: <strong>[:digit:]</strong> for numbers, <strong>[:alpha:]</strong> for letters, <strong>[:punct:]</strong> for punctuation, and <span class="math inline">\(\textbf{.}\)</span> for every character.</p></li>
<li><p>See the RStudio cheat sheet on stringr for more examples (and in general, as a brilliant reference to <em>regex</em>)</p></li>
</ul></li>
</ul>
<p><br></p>
</div>
<div id="how-many-times-to-match" class="section level3">
<h3>How many times to match?</h3>
<p>Aside from specifiying the characters to match, such as “[0-9]”, another important component of regular expressions is how many time should the characters appear.</p>
<ul>
<li>“[0-9]” will match any part of a string composed of exactly <em>1</em> number.</li>
<li>“[0-9]+” will match any part of a string composed of <em>1 or more</em> numbers.</li>
<li>“[0-9]{4}” will match any part of a string composed of exactly <em>4</em> numbers.</li>
<li>“[0-9]*&quot; will match any part of a string composed of zero or more numbers.</li>
</ul>
<p><br></p>
<div id="examples-with-repetition" class="section level4">
<h4>Examples with repetition</h4>
<p>Suppose we want to extract year data that is mixed in with other data as well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">messy_var &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1987</span>,<span class="dv">2006</span>,<span class="dv">2010</span>,<span class="dv">307</span>,<span class="dv">2018</span>)
<span class="kw">str_extract</span>(messy_var, <span class="st">&quot;[0-9]&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;1&quot; &quot;1&quot; &quot;2&quot; &quot;2&quot; &quot;3&quot; &quot;2&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_extract</span>(messy_var, <span class="st">&quot;[0-9]+&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;1&quot;    &quot;1987&quot; &quot;2006&quot; &quot;2010&quot; &quot;307&quot;  &quot;2018&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_extract</span>(messy_var, <span class="st">&quot;[0-9]{4}&quot;</span>)</code></pre></div>
<pre><code>## [1] NA     &quot;1987&quot; &quot;2006&quot; &quot;2010&quot; NA     &quot;2018&quot;</code></pre>
<p><br></p>
</div>
</div>
<div id="escaping-special-characters" class="section level3">
<h3>Escaping special characters</h3>
<p>Often, special characters can cause problems when working with strings. For example, trying to add a quote can result in R thinking you are trying to close the string.</p>
<p>For most characters, you can “escape” (cause R to read as part of the string) special characters by prepending them with a backslash.</p>
<p><strong>Example:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">quote &lt;-<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">Without data, you&#39;re just another person with an opinion.</span><span class="ch">\&quot;</span><span class="st"> </span>
<span class="st">- W. Edwards Deming.&quot;</span>
<span class="kw">writeLines</span>(quote)</code></pre></div>
<pre><code>## &quot;Without data, you&#39;re just another person with an opinion.&quot; 
## - W. Edwards Deming.</code></pre>
<p><br></p>
</div>
<div id="matching-strings-that-precede-or-follow-specific-patterns" class="section level3">
<h3>Matching strings that precede or follow specific patterns</h3>
<p>To match part of a string that occurs before or after a specific other pattern, you can also specify “lookarounds”, the pattern the match should precede or follow:</p>
<p>To match a string pattern x, preceded or followed by y:</p>
<ul>
<li><p><strong>y precedes x:</strong> “(?&lt;=y)x”</p></li>
<li><p><strong>y follows x:</strong> “x(?=y)”</p></li>
</ul>
<p><br></p>
</div>
<div id="look-around-example" class="section level3">
<h3>Look around example</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">price_info &lt;-<span class="kw">c</span>(<span class="st">&quot;The price is 5 dollars&quot;</span>)
<span class="kw">str_extract</span>(price_info, <span class="st">&quot;(?&lt;=(The price is )).+&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;5 dollars&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_extract</span>(price_info, <span class="st">&quot;.+(?=( dollars))&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;The price is 5&quot;</code></pre>
<p><br> <br></p>
</div>
</div>
<div id="web-scraping" class="section level2">
<h2><strong>Web Scraping</strong></h2>
<div id="web-scraping-with-rvest" class="section level3">
<h3>Web scraping with Rvest</h3>
<p>“Scraping” data from the web - that is, automating the retrieval of data displayed online (other than through API) is an increasingly common data analysis task.</p>
<ul>
<li><p>Today, we will briefly explore very rudimentary web scraping, using the <strong>rvest</strong> package.</p></li>
<li><p>The specific focus today is only on scraping data structued as a table on a webpage. The basic method highlighted will work much of the time - but does not work for every table.</p></li>
</ul>
<p><br></p>
</div>
<div id="using-rvest-to-scrape-a-table" class="section level3">
<h3>Using rvest to scrape a table</h3>
<ul>
<li><p>The starting point for scraping a web table with rvest is the <strong>read_html()</strong> function, where the URL to the page with data should go.</p></li>
<li><p>After reading the webpage, the table should be parsed. For many tables, the <strong>read_html</strong> can be piped directly into the <strong>html_table()</strong> function.</p>
<ul>
<li>If this works, the data should then be converted from a list into a dataframe/tibble.</li>
</ul></li>
<li><p>If <strong>html_table()</strong> does not work, a more robust option is to first pipe <strong>read_html</strong> into <strong>html_nodes(xpath = “//table”)</strong> and then into <strong>html_table(fill=TRUE)</strong></p>
<ul>
<li><strong>html_nodes(xpath = “//table”)</strong> looks for all HTML objects coded as a table, hence</li>
</ul></li>
</ul>
<p><br></p>
</div>
<div id="web-scraping-example" class="section level3">
<h3>Web scraping example</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tech_stock_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;MSFT&quot;</span>,<span class="st">&quot;AMZN&quot;</span>,<span class="st">&quot;GOOGL&quot;</span>,<span class="st">&quot;AAPL&quot;</span>,<span class="st">&quot;FB&quot;</span>,<span class="st">&quot;INTC&quot;</span>,<span class="st">&quot;CSCO&quot;</span>)
tech_stocks &lt;-<span class="st"> </span><span class="kw">list</span>()
<span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(tech_stock_names)){
  tech_stocks[[j]] &lt;-<span class="kw">read_html</span>(
    <span class="kw">glue</span>(<span class="st">&quot;https://finance.yahoo.com/quote/{tech_stock_names[j]}/history&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_table</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">stock =</span> tech_stock_names[j])
}
tech_stocks <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">bind_rows</span>()
tech_stocks[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">6</span><span class="op">:</span><span class="dv">8</span>)]</code></pre></div>
<pre><code>##           Date Adj.Close..     Volume stock
## 1 Mar 07, 2019      110.39 25,321,300  MSFT
## 2 Mar 06, 2019      111.75 17,687,000  MSFT
## 3 Mar 05, 2019      111.70 19,538,300  MSFT
## 4 Mar 04, 2019      112.26 26,608,000  MSFT
## 5 Mar 01, 2019      112.53 23,501,200  MSFT</code></pre>
</div>
<div id="another-webscraping-example" class="section level3">
<h3>Another webscraping example</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gini_list &lt;-<span class="kw">read_html</span>(<span class="st">&quot;http://wdi.worldbank.org/table/1.3&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="dt">xpath =</span><span class="st">&quot;//table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_table</span>(<span class="dt">fill=</span><span class="ot">TRUE</span>) 
gini_data &lt;-<span class="st"> </span>gini_list <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">extract2</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)
gini_data[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</code></pre></div>
<pre><code>##               X1   X2   X3
## 1    Afghanistan   ..   ..
## 2        Albania 2012 29.0
## 3        Algeria 2011 27.6
## 4 American Samoa   ..   ..
## 5        Andorra   ..   ..</code></pre>
<p><br> <br></p>
</div>
</div>
</div>
<div id="project-management-and-dynamic-documents" class="section level1">
<h1><strong>Project management and dynamic documents</strong></h1>
<p><br></p>
<div id="rmarkdown-documents" class="section level2">
<h2><strong>RMarkdown documents</strong></h2>
<div id="reproducible-r-reports" class="section level3">
<h3>Reproducible R Reports</h3>
<ul>
<li><p>So far, we have been working purely with basic “R Script” files, which are very similar to Stata do-files.</p></li>
<li><p>But thanks largely to the <a href="https://yihui.name/knitr/">knitr package</a>, you can easily create reports that interweaves text and R code in a neatly structured manner.</p></li>
<li><p>Output can be structured as PDF documents, HTML webpages, Word documents, or various presentation formats including Beamer (LaTex) presentations.</p></li>
<li><p>The course website, lecture slides, and exercise instructions have all been generated in R.</p></li>
</ul>
<p><br></p>
</div>
<div id="getting-started" class="section level3">
<h3>Getting started</h3>
<ul>
<li><p>Reports of different file formats are generated using the <a href="https://yihui.name/knitr/">knitr package</a>.</p></li>
<li><p>Before installing knitr, make sure sure that you have a Latex distribution installed.</p></li>
<li><p>Then install the knitr package and initialize it in the usual manner.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Run only once (ie in the console)</span>
    <span class="co"># install.packages(&quot;knitr&quot;) </span>

<span class="co"># Initialize library</span>
<span class="kw">library</span>(<span class="st">&quot;knitr&quot;</span>)</code></pre></div>
<p><br></p>
</div>
<div id="knitr-and-rmarkdown" class="section level3">
<h3>Knitr and RMarkdown</h3>
<p>Knitr allows for the creation of documents structured using two different typesetting languages:</p>
<ul>
<li><p>LaTex with the .RNW file</p></li>
<li><p>Markdown (specifically <em>RMarkdown</em>), which was originally created as a simple language for structuring HTML markup.</p></li>
</ul>
<p>For this course, we will focus on the <strong>RMarkdown</strong> format, which has become the dominant method for “knitting” document because of it’s lightweight and flexibility.</p>
<ul>
<li>More information about how to generate R reports using the Latex format can be found at <a href="https://rpubs.com/YaRrr/SweaveIntro" class="uri">https://rpubs.com/YaRrr/SweaveIntro</a>.</li>
</ul>
<p><br></p>
</div>
<div id="creating-an-rmarkdown-document" class="section level3">
<h3>Creating an RMarkdown document</h3>
<ul>
<li><p>After installing knitr, to create an RMarkdown document, go to <strong>File—New File—R Markdown</strong>.</p></li>
<li><p>A popup shows up to ask enter the document Title and Author, as well as what type of document you want to create.</p></li>
</ul>
<div class="figure">
<img src="assets/NewRMD.png" />

</div>
<p><br></p>
</div>
<div id="writing-and-code-in-rmarkdown" class="section level3">
<h3>Writing and Code in RMarkdown</h3>
<p>In RMarkdown, expository writing and code “chunks” are differentiated in writing code in specific code chunks.</p>
<pre><code>```{r}
# Here is an example of a code chunk
2 +2 
```</code></pre>
<p>When you create the document, that statement gets evaluated as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co"># Here is an example of a code chunk</span>
    <span class="dv">2</span> <span class="op">+</span><span class="dv">2</span> </code></pre></div>
<pre><code>## [1] 4</code></pre>
<p><br></p>
</div>
<div id="inline-chunks" class="section level3">
<h3>Inline Chunks</h3>
<p>You can also include inline code by using initializing with a backtick and the letter r (no space between), writing the code, then closing the chunk with another backtick.</p>
<ul>
<li>For example: <code  class="r"><code>`r 2+2`</code></code></li>
</ul>
<p><br></p>
</div>
<div id="knitting-a-document" class="section level3">
<h3>Knitting a document</h3>
<p>To generate a document in the desired output format from a RMarkdown document, you need to <strong>“Knit”</strong> the document, which appears as a clickable icon on the menu atop the script pane.</p>
<p>You do not need to Knit a document after every change, however. You can just as easily run the code chunks. There are specific specific buttons to run either the current chunk or all of the chunks above a given chunk.</p>
<div class="figure">
<img src="assets/RMDbuttons.png" />

</div>
<p><br></p>
</div>
<div id="writing-outside-of-code-chunks" class="section level3">
<h3>Writing outside of code chunks</h3>
<p>Anything not written inside of these bacticked sections is interpret as normal writing.</p>
<p>RMarkdown makes styling your writing particularly easy. Some common formatting options include:</p>
<ul>
<li><strong>Headers:</strong> Headers are defined using hashes (#)
<ul>
<li>A single # indicates a top level heading (and bigger font), while each additional hash indicates a smaller heading size</li>
<li>So while # is the largest heading size, #### is a small heading</li>
</ul></li>
<li><strong>Bold</strong>: To bold text, wrap it in two asterisks: <code>**Bold Statement**</code></li>
<li><strong>Italics:</strong> To italicize text, wrap in a single asterisk:        <code>*Italics Statement*</code></li>
</ul>
<p><br></p>
</div>
<div id="lists-and-latex-input" class="section level3">
<h3>Lists and Latex Input</h3>
<ul>
<li><p><strong>Latex input:</strong> Most LaTex commands (except for generally longer multi-line structures) can be included in RMarkdown documents just as you’d write them in Tex document.</p></li>
<li><p><strong>Lists/Bullet Points</strong>: Like the bullet points here, you will often want to structure output using lists.</p>
<ul>
<li><p>To create a bulleted list, start each bulleted line with a dash (-).</p></li>
<li><p>Make sure to leave an empty line between the start of the list and any other text.</p></li>
<li><p>To make an indent “sub-list”, start the sub-list with a plus sign (+) and use tab to indent the line twice for each of the sub-list items.</p></li>
</ul></li>
</ul>
<p><br></p>
</div>
<div id="ordered-lists" class="section level3">
<h3>Ordered Lists</h3>
<ul>
<li><p>Ordered lists use the same indent rules as unordered lists, but with no dashes or plus signs.</p>
<ul>
<li>You can also generally uses automatic numbering by repeating the initial letter or number (e.g.)</li>
</ul></li>
</ul>
<div class="figure">
<img src="assets/ordered_list.png" />

</div>
<p><br></p>
</div>
<div id="seperating-lines-in-rmarkdown" class="section level3">
<h3>Seperating Lines in RMarkdown</h3>
<ul>
<li><p>Something you might wonder is how to obey the RStudio 80-character margins while allowing your text to wrap normally in the generated documents.</p></li>
<li><p>The answer lies in how new lines are treated in RMarkdown documents.</p>
<ul>
<li>If the line ends with one space or less, a new line in RMarkdown will not be treated as a new line in the documents generated.</li>
</ul></li>
</ul>
<p><br></p>
</div>
<div id="code-chunk-options" class="section level3">
<h3>Code chunk options</h3>
<p>There are several output options you can specify for how R code and the code output are expressed in reports. These options are expressed as options in the {r} declaration at the top of the chunk.</p>
<ul>
<li><p><strong>echo=FALSE</strong>: do not show the R code itself (but potentially the code output depending on other chunk options).</p></li>
<li><p><strong>include=FALSE</strong>: do not show the R code or the output in the document.</p></li>
<li><p><strong>eval=FALSE:</strong> do not actually execute the code inside the chunk, only display it.</p></li>
<li><p><strong>results=“hide”</strong>: run the code but do not show the results output.</p></li>
<li><p><strong>warning=FALSE</strong> / <strong>message=FALSE</strong>: do not show    warnings or messages associated with the R code.</p></li>
</ul>
<p><br></p>
</div>
<div id="output-options" class="section level3">
<h3>Output options</h3>
<p>When a RMarkdown document is generated in a given output format, there are several common things you can do to customize the appearance of the document.</p>
<p>To add options to your document, indent the name of the output type to an indented new line and a colon to it. Then indent under the output type and add the desired options.</p>
<div class="figure">
<img src="assets/output_options_before.png" alt="Before" />
<p class="caption"><strong>Before</strong></p>
</div>
<div class="figure">
<img src="assets/output_options_after.png" alt="After" />
<p class="caption"><strong>After</strong></p>
</div>
<p><br></p>
</div>
<div id="common-output-options" class="section level3">
<h3>Common output options</h3>
<p>Here are a few common options:</p>
<ul>
<li><p><strong>table of contents</strong>: to include a table of contents in your document, use the <span style="color:blue"><strong>toc: yes</strong></span> option.</p></li>
<li><p>To change the way data frame output is printed, use the <span style="color:blue"><strong>df_print</strong></span> option. Good options are <span style="color:blue"><strong>kable</strong></span> or <span style="color:blue"><strong>tibble</strong></span>.</p></li>
<li><p>To add code highlighting for R chunks, use the <span style="color:blue"><strong>highlight:</strong></span> option.</p>
<ul>
<li><strong>Options include:</strong> default, tango, pygments, kate, monochrome, espresso, zenburn, haddock, and textmate.</li>
</ul></li>
<li><p>You can also specify output themes for html documents and beamer presentations. For html documents, possible themes are listed <a href="https://rmarkdown.rstudio.com/html_document_format.html#appearance_and_style">here</a> while beamer themes are typically supplied       by .sty files in your project folder.</p></li>
</ul>
<p><br></p>
</div>
<div id="working-directories-in-rmarkdown" class="section level3">
<h3>Working Directories in RMarkdown</h3>
<p>In RMarkdown documents, the working directory is automatically set to the folder in which the RMarkdown document is saved.</p>
<ul>
<li><p>From there, you can use <em>relative file paths</em>. If data etc is in the root of the project folder, then just refer to the file name directly.</p></li>
<li><p>If data is in a subfolder, eg <em>data</em>, use a relative path like:</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">import</span>(<span class="st">&quot;./assets/mydata.rds&quot;&quot;)</span></code></pre></div>
<p><br></p>
</div>
<div id="r-notebooks" class="section level3">
<h3>R Notebooks</h3>
<p>Aside from the standard RMarkdown documents that we’ve covered so far, another format worth mentioning is the <strong>R Notebook</strong> format.</p>
<ul>
<li><p>R Notebooks essentially adapt html RMarkdown documents to be even more similar to something like Jupyter Notebooks.</p></li>
<li><p>With R Notebooks, you can <strong><em>Preview</em></strong> documents without knitting them over again.</p></li>
<li><p>The document also generally has the Notebook-style code-output-code layout.</p></li>
</ul>
<p><br></p>
<p><br></p>
</div>
</div>
<div id="rstudio-projects" class="section level2">
<h2><strong>RStudio Projects</strong></h2>
<div id="projects-intro" class="section level3">
<h3>Projects Intro</h3>
<p>In addition to using RMarkdown documents to make your scripts and reports more compelling, another process upgrade is using <strong>RStudio Projects</strong>.</p>
<p>Projects are useful because they:</p>
<ul>
<li>Define a project root folder</li>
<li>Save a RStudio environment that is unique to each project</li>
<li>Allow for easy version control</li>
</ul>
<p><br></p>
</div>
<div id="working-folder-benefits-of-a-project" class="section level3">
<h3>Working folder benefits of a Project</h3>
<ul>
<li><p>A project root folder is not only preferable to the need to use <strong>setwd()</strong>, but also to the default working directory used in RMarkdown documents outside of R Projects. Why?</p></li>
<li><p>Because for substantial research projects, you likely will have a lot of files that you split into different subfolders, one of which is probably something like <strong><em>code</em></strong>.</p>
<ul>
<li>In this case, you’d need to use somewhat convoluted relative file paths to indicate that the paths should be from the parent folder of <strong><em>code</em></strong>.</li>
</ul>
<p><br></p></li>
</ul>
</div>
<div id="using-rstudio-projects" class="section level3">
<h3>Using RStudio Projects</h3>
<p>To create a RStudio Project, go to <strong>File – New Project</strong>. From there, you can choose whether to create a new directory, use an existing directory, or use a Version Control repository.</p>
<ul>
<li><p>In practice, I’d suggest you use either a <strong>New Directory</strong> or <strong>Version Control</strong> depending on whether or not you want to sync your scripts to GitHub.</p>
<ul>
<li>We’ll go over version control shortly.</li>
</ul></li>
</ul>
<p>Once you have created a Project, you can either open it from the File Menu or by opening the .RProj file in the project directory     root.</p>
<p><br></p>
</div>
<div id="project-workflow-structure" class="section level3">
<h3>Project workflow structure</h3>
<p><strong>Sample Folder Structure:</strong></p>
<ul>
<li>code/
<ul>
<li>data_prep/</li>
<li>analysis/</li>
</ul></li>
<li>data/
<ul>
<li>raw_data/</li>
<li>derived_data/</li>
</ul></li>
</ul>

<ul>
<li>docs/
<ul>
<li>report/</li>
<li>presentation/</li>
</ul></li>
<li>images/</li>
<li>results/
<ul>
<li>tables/</li>
<li>figures/</li>
</ul></li>
</ul>
<p><strong>Some workflow management packages:</strong></p>
<ul>
<li><a href="https://github.com/benmarwick/rrtools">rrtools</a></li>
<li><a href="https://jdblischak.github.io/workflowr/index.html">workflowr</a></li>
<li><a href="http://projecttemplate.net/">ProjectTemplate</a></li>
<li><a href="http://pirategrunt.com/represtools/">represtools</a></li>
</ul>
<p><br></p>
</div>
<div id="reproducibility-and-the-r-environment" class="section level3">
<h3>Reproducibility and the R environment</h3>
<ul>
<li><p>A concern with any type of analysis project is that over time, the analysis environment can change – making it harder to reproduce results.</p>
<ul>
<li>The most common concern is that packages may change or become obsolete</li>
<li>But also the program itself (R) can change, the OS can change, etc. All potentially leading to the inability to reproduce results.</li>
</ul></li>
</ul>
<p><br></p>
</div>
<div id="managing-the-r-environment" class="section level3">
<h3>Managing the R environment</h3>
<ul>
<li>A solution to evolving package ecosystems built-in to R Projects is <a href="https://rstudio.github.io/packrat/">packrat</a>.
<ul>
<li><strong>packrat</strong> can create a package library specific to the individual project.</li>
</ul></li>
<li>A more robust reproducibility solution is with <a href="https://ropenscilabs.github.io/r-docker-tutorial/">Docker</a>, which creates “containers” in which not only packages are fixed, but also the software (and even the virtual machine).</li>
</ul>
<p><br> <br></p>
</div>
</div>
<div id="version-control" class="section level2">
<h2><strong>Version Control</strong></h2>
<div id="what-is-version-control" class="section level3">
<h3>What is version control?</h3>
<p>Version control is a means to track changes made to files</p>
<p>Version control allows you to:</p>
<ul>
<li>See a history of every change made to files -Annotate changes -Allow you to revert files to previous versions</li>
</ul>
<p><br></p>
</div>
<div id="local-version-control-with-git" class="section level3">
<h3>Local Version Control with Git</h3>
<p>The most popular software for managing version control is Git.</p>
<ul>
<li><p>There’s a good chance you’ve at least seen GitHub before, which is an online remote location for storing version control repositories.</p></li>
<li><p>The Git software, however, is equally adept at managing version control on your local computer.</p></li>
</ul>
<p>Once Git is installed (and recognized in RStudio), you can use Projects to perform local version control.</p>
<p>In <strong>File – New Project – New Directory</strong>, once you have Git installed there is a checkbox that can be selected to enable to “Create a Git repository”.</p>
<ul>
<li><p>A repository is a location that Git uses to track the changes of a file or folder, here the project folder. The Git repository is stored as a folder named “.git” in the project root.</p></li>
<li><p>Creating a Project in this manner with a Git repository will enable version control on your local computer.</p></li>
</ul>
<p><br></p>
</div>
<div id="remote-version-control-with-github" class="section level3">
<h3>Remote version control with GitHub</h3>
<ul>
<li><p>In addition to local version control, you can also back up the history of file changes to online repositories using GitHub.</p></li>
<li><p>GitHub connects to the local Git repository on your computer, “pushing” and “pulling” changes between the local and remote repositories.</p></li>
<li><p>This also allows for easy collaboration on coding projects, as multiple person can sync to files by connecting to the remote repository.</p></li>
</ul>
<p><br></p>
</div>
<div id="using-github-for-remote-version-control" class="section level3">
<h3>Using GitHub for remote version control</h3>
<p>With a GitHub account, you can create a new online repository by clicking the “+” icon in the top right of a GitHub page, and then clicking “New Repository”.</p>
<div class="figure">
<img src="assets/github.png" />

</div>
<p><br></p>
</div>
<div id="setting-up-a-new-repository" class="section level3">
<h3>Setting up a new repository</h3>
<p>From there, you need to:</p>
<ul>
<li><p>Supply GitHub with a repository name (think folder name)</p></li>
<li><p>Choose whether or not the repository should be public or private (ie whether or not you want other people to be able to visit your GitHub page and view the repository).</p>
<ul>
<li>If you have a GitHub education account, then Private repositories are free. Otherwiwse, you’d need a paid GitHub subscription.</li>
</ul></li>
<li><p>Click on the checkbox to enable “Initialize this repository with a README”.</p>
<ul>
<li>Each repository is required to have a readme file, which you may want to comment but is not strictly necessary. Commenting uses Markdown, which is essentially the same as RMarkdown!</li>
</ul></li>
</ul>
<p><br></p>
</div>
<div id="using-a-remote-repository-with-github" class="section level3">
<h3>Using a Remote Repository with GitHub</h3>
<p>Once you’ve created an online repository, <strong><em>Projects</em></strong> once again allows you to easily connect RStudio with the repository.</p>
<ul>
<li><p>To setup a project for use with GitHub, create a <strong>New Project</strong> and select <strong>Version Control</strong> instead of <strong>New Directory.</strong></p></li>
<li><p>From there, simply choose “Git” and then copy the url of the repository from GitHub into RStudio.</p></li>
</ul>
<p><br></p>
</div>
<div id="tracking-changes-with-git" class="section level3">
<h3>Tracking changes with Git</h3>
<p>Once you have a Project setup with version control, the first key component of tracking changes is “Committing” them to the repository</p>
<ul>
<li>A “commit” is an update that saves revisions of files into the Git repository.</li>
</ul>
<p>You can commit changes by going to the “Git” tab in the upper right-hand side of the RStudio IDE.</p>
<ul>
<li><p>In the Git tab, any files that have changed since the last commit are listed. From there, click on the files you’d like to commit and click on the commit button.</p></li>
<li><p>A Commit box appears which shows you the changes since    the last revision and asks for a commit message, where you should very briefly describe the changes.</p></li>
</ul>
<div class="figure">
<img src="assets/commit.png" />

</div>
<p><br></p>
</div>
<div id="syncing-changes-with-a-remote-repository" class="section level3">
<h3>Syncing changes with a remote repository</h3>
<ul>
<li><p>If you are just tracking changes with a local repository, commit is sufficient to manage version control.</p></li>
<li><p>But if you are using version control with an remote (ie online) repository, you will two other steps to make sure changes are sync between the local repository and online.</p>
<ul>
<li><p>To send changes made locally to the online repository, after comitting changes click on “Push.”</p></li>
<li><p>To sync changes from the online repository to local files, click on “Pull”.</p></li>
</ul></li>
</ul>
<p><br></p>
</div>
<div id="viewing-previous-commits" class="section level3">
<h3>Viewing previous commits</h3>
<ul>
<li><p>To view previous versions of the files (along with annotations supplied with the commit message), click on the clock icon in the Git pane.</p></li>
<li><p>From there, you can see not only a “difference” view of the file changes, but you can also open the document exactly how it was written in a previous commit.</p></li>
<li><p>From there, if you wanted to revert changes, you <em>could</em> explicitly revert the file with Git, or simply copy over the file with code from the previous commit — my preferred method of reverting changes.</p></li>
</ul>
<p><br> <br></p>
</div>
</div>
</div>
<div id="regression-analysis-and-data-visualization" class="section level1">
<h1><strong>Regression analysis and data visualization</strong></h1>
<p><br></p>
<div id="regression-basics" class="section level2">
<h2>Regression Basics</h2>
<p><br></p>
<div id="linear-regression" class="section level3">
<h3>Linear Regression</h3>
<p>The basic method of performing a linear regression in R is to the use the <a href="https://www.rdocumentation.org/packages/stats/versions/3.4.3/topics/lm">lm()</a> function.</p>
<ul>
<li>To see the parameter estimates alone, you can just call the <code>lm()</code> function. But much more results are available if you save the results to a regression output object, which can then be accessed using the <a href="https://www.rdocumentation.org/packages/base/versions/3.4.3/topics/summary">summary()</a> function.</li>
</ul>
<p>Syntax:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myregobject &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span>x3 <span class="op">+</span><span class="st"> </span>x4, 
                  <span class="dt">data =</span> mydataset)</code></pre></div>
<p><br></p>
<div id="cex-linear-regression-example" class="section level4">
<h4>CEX linear regression example</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lm</span>(expenditures <span class="op">~</span><span class="st"> </span>educ_ref, <span class="dt">data=</span>cex_data)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = expenditures ~ educ_ref, data = cex_data)
## 
## Coefficients:
## (Intercept)     educ_ref  
##      -641.1        109.3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cex_linreg &lt;-<span class="st"> </span><span class="kw">lm</span>(expenditures <span class="op">~</span><span class="st"> </span>educ_ref, 
                 <span class="dt">data=</span>cex_data)

<span class="kw">summary</span>(cex_linreg)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = expenditures ~ educ_ref, data = cex_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -541109    -899    -690    -506  965001 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -641.062     97.866   -6.55 5.75e-11 ***
## educ_ref     109.350      7.137   15.32  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7024 on 305970 degrees of freedom
##   (75769 observations deleted due to missingness)
## Multiple R-squared:  0.0007666,  Adjusted R-squared:  0.0007634 
## F-statistic: 234.7 on 1 and 305970 DF,  p-value: &lt; 2.2e-16</code></pre>
<p><br></p>
</div>
</div>
<div id="formatting-regression-output-tidyr" class="section level3">
<h3>Formatting regression output: tidyr</h3>
<p>With the <a href="https://www.rdocumentation.org/packages/broom/versions/0.4.3/topics/tidy">tidy()</a> function from the <a href="https://www.rdocumentation.org/packages/broom">broom</a> package, you can easily create standard regression output tables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(broom)
<span class="kw">tidy</span>(cex_linreg)</code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)    -641.     97.9      -6.55 5.75e-11
## 2 educ_ref        109.      7.14     15.3  5.75e-53</code></pre>
<p><br></p>
</div>
<div id="formatting-regression-output-stargazer" class="section level3">
<h3>Formatting regression output: stargazer</h3>
<p>Another really good option for creating compelling regression and summary output tables is the <a href="https://www.rdocumentation.org/packages/stargazer/">stargazer</a> package.</p>
<ul>
<li>If you write your reports in LaTex, it’s especially useful.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># From console:  install.packages(&quot;stargazer&quot;)</span>

<span class="kw">library</span>(stargazer)

<span class="kw">stargazer</span>(cex_linreg, <span class="dt">header=</span><span class="ot">FALSE</span>, <span class="dt">type=</span><span class="st">&#39;html&#39;</span>)</code></pre></div>
<p><br></p>
<table style="text-align:center">
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
expenditures
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
educ_ref
</td>
<td>
109.350<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(7.137)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
-641.062<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(97.866)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
305,972
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.001
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.001
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
7,024.151 (df = 305970)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
234.746<sup>***</sup> (df = 1; 305970)
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td style="text-align:right">
<sup><em></sup>p&lt;0.1; <sup><strong></sup>p&lt;0.05; <sup></strong></em></sup>p&lt;0.01
</td>
</tr>
</table>
<p><br></p>
</div>
<div id="interactions-and-indicator-variables" class="section level3">
<h3>Interactions and indicator variables</h3>
<p>Including interaction terms and indicator variables in R is very easy.</p>
<ul>
<li><p>Including any variables coded as factors (ie categorical variables) will automatically include indicators for each value of the factor.</p></li>
<li><p>To specify interaction terms, just specify <code>varX1*varX2</code>.</p></li>
<li><p>To specify higher order terms, write it mathematically inside of <strong>I()</strong>.</p></li>
</ul>
<p><br></p>
<p><strong>Example:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages_reg &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span>schooling <span class="op">+</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>
<span class="st">          </span>schooling<span class="op">*</span>sex <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(exper<span class="op">^</span><span class="dv">2</span>), <span class="dt">data=</span>wages)

<span class="kw">tidy</span>(wages_reg)</code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   term              estimate std.error statistic  p.value
##   &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)       -2.05      0.611      -3.36  7.88e- 4
## 2 schooling          0.567     0.0501     11.3   3.30e-29
## 3 sexmale           -0.326     0.779      -0.418 6.76e- 1
## 4 I(exper^2)         0.00752   0.00144     5.21  2.03e- 7
## 5 schooling:sexmale  0.143     0.0660      2.17  3.01e- 2</code></pre>
<p><br></p>
</div>
<div id="setting-reference-groups-for-factors" class="section level3">
<h3>Setting reference groups for factors</h3>
<p>By default, when including factors in R regression, the first <em>level</em> of the factor is treated as the omitted reference group.</p>
<ul>
<li>An easy way to instead specify the omitted reference group is to use the <a href="https://www.rdocumentation.org/packages/stats/versions/3.4.3/topics/relevel">relevel()</a> function.</li>
</ul>
<p><br></p>
<p><strong>Example:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages<span class="op">$</span>sex &lt;-<span class="st"> </span>wages<span class="op">$</span>sex <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">relevel</span>(<span class="dt">ref=</span><span class="st">&quot;male&quot;</span>)

wagereg2 &lt;-<span class="st"> </span><span class="kw">lm</span>(wage <span class="op">~</span><span class="st"> </span>sex, <span class="dt">data=</span>wages); <span class="kw">tidy</span>(wagereg2)</code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)     6.31    0.0775      81.5 0.      
## 2 sexfemale      -1.17    0.112      -10.4 6.71e-25</code></pre>
<p><br></p>
</div>
<div id="useful-output-from-regression" class="section level3">
<h3>Useful output from regression</h3>
<p>A couple of useful data elements that are created with a regression output object are fitted values and residuals. You can easily access them as follows:</p>
<ul>
<li><strong>Residuals:</strong> Use the <a href="https://www.rdocumentation.org/packages/stats/versions/3.4.3/topics/residuals">residuals()</a> function.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myresiduals &lt;-<span class="st"> </span><span class="kw">residuals</span>(myreg)</code></pre></div>
<ul>
<li><strong>Predicted values:</strong> Use the <a href="https://www.rdocumentation.org/packages/stats/versions/3.4.3/topics/fitted">fitted()</a> function.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myfittedvalues &lt;-<span class="st"> </span><span class="kw">fitted</span>(myreg)</code></pre></div>
<p><br> <br></p>
</div>
</div>
<div id="model-testing" class="section level2">
<h2>Model Testing</h2>
<div id="using-the-lmtest-package" class="section level3">
<h3>Using the lmtest package</h3>
<p>The main package for specification testing of linear regressions in R is the <a href="https://www.rdocumentation.org/packages/lmtest/">lmtest</a> package.</p>
<p>With it, you can:</p>
<ul>
<li>test for heteroskedasticity</li>
<li>test for autocorrelation</li>
<li>test functional form (eg Ramsey RESET test)</li>
<li>discriminate between non-nested models and more</li>
</ul>
<p>All of the tests covered here are from the <a href="https://www.rdocumentation.org/packages/lmtest/">lmtest</a> package. As usual, you need to install and initialize the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## In the console:  install.packages(&quot;lmtest&quot;)
<span class="kw">library</span>(lmtest)</code></pre></div>
<p><br></p>
</div>
<div id="testing-for-heteroskedasticity" class="section level3">
<h3>Testing for heteroskedasticity</h3>
<p>Testing for heteroskedasticity in R can be done with the <a href="https://www.rdocumentation.org/packages/lmtest/versions/0.9-35/topics/bptest">bptest()</a> function from the <a href="https://www.rdocumentation.org/packages/lmtest">lmtest</a> to the model object.</p>
<ul>
<li>By default, using a regression object as an argument to <a href="https://www.rdocumentation.org/packages/lmtest/versions/0.9-35/topics/bptest">bptest()</a> will perform the Koenker-Bassett version of the Breusch-Pagan test (aka ‘generalized’ or ‘studentized’ Breusch-Pagan Test):</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bptest</span>(wages_reg)</code></pre></div>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  wages_reg
## BP = 22.974, df = 4, p-value = 0.0001282</code></pre>
<ul>
<li>If you want the “standard” form of the Breusch-Pagan Test, just use:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bptest</span>(myreg, <span class="dt">studentize =</span> <span class="ot">FALSE</span>)</code></pre></div>
<ul>
<li><p>You can also perform the White Test of Heteroskedasticity using <a href="https://www.rdocumentation.org/packages/lmtest/versions/0.9-35/topics/bptest">bptest()</a> by manually specifying the regressors of the auxiliary regression inside of <code>bptest</code>:</p>
<ul>
<li>That is, specify the distinct regressors from the main equation, their squares, and cross-products.</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bptest</span>(myreg, <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span>x1<span class="op">*</span>x2 <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(x1<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">         </span><span class="kw">I</span>(x2<span class="op">^</span><span class="dv">2</span>), <span class="dt">data=</span>mydata)</code></pre></div>
<p><br></p>
</div>
<div id="functional-form" class="section level3">
<h3>Functional form</h3>
<p>The <strong>Ramsey RESET Test</strong> tests functional form by evaluating if higher order terms have any explanatory value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">resettest</span>(wages_reg)</code></pre></div>
<pre><code>## 
##  RESET test
## 
## data:  wages_reg
## RESET = 7.1486, df1 = 2, df2 = 3287, p-value = 0.0007983</code></pre>
<p><br></p>
</div>
<div id="testing-for-autocorrelation-breusch-godfrey-test" class="section level3">
<h3>Testing for autocorrelation: Breusch-Godfrey test</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bgtest</span>(wages_reg)</code></pre></div>
<pre><code>## 
##  Breusch-Godfrey test for serial correlation of order up to 1
## 
## data:  wages_reg
## LM test = 7.0938, df = 1, p-value = 0.007735</code></pre>
<p><br></p>
</div>
<div id="testing-for-autocorrelation-durbin-watson-test" class="section level3">
<h3>Testing for autocorrelation: Durbin-Watson test</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dwtest</span>(wages_reg)</code></pre></div>
<pre><code>## 
##  Durbin-Watson test
## 
## data:  wages_reg
## DW = 1.9073, p-value = 0.003489
## alternative hypothesis: true autocorrelation is greater than 0</code></pre>
<p><br></p>
</div>
<div id="specifying-the-variance-structure" class="section level3">
<h3>Specifying the variance structure</h3>
<p>In practice, errors should <em>almost always</em> be specified in a manner that is heteroskedasticity and autocorrelation consistent.</p>
<ul>
<li>In Stata, you can pretty much always use the <strong>robust</strong> option.</li>
<li><p>In R, you should more explicitly specify the variance structure.</p>
<ul>
<li><p>The <a href="https://cran.r-project.org/web/packages/sandwich/">sandwich</a> allows for specification of heteroskedasticity-robust, cluster-robust, and heteroskedasticity and autocorrelation-robust error structures.</p></li>
<li><p>These can then be used with t-tests [<a href="https://www.rdocumentation.org/packages/lmtest/versions/0.9-35/topics/coeftest">coeftest()</a>] and F-tests [<a href="https://www.rdocumentation.org/packages/lmtest/versions/0.9-35/topics/waldtest">waldtest()</a>] from <a href="https://www.rdocumentation.org/packages/lmtest">lmtest</a>.</p></li>
</ul></li>
</ul>
<p><br></p>
</div>
<div id="heteroskedasticity-robust-errors" class="section level3">
<h3>Heteroskedasticity-robust errors</h3>
<p><span class="math inline">\(HC_1\)</span> Errors (MacKinnon and White, 1985): <span class="math inline">\(\Sigma = \frac{n}{n-k}diag{\hat\{u_i}^2\}\)</span></p>
<ul>
<li>Default heteroskedasticity-robust errors used by Stata with <strong>robust</strong></li>
</ul>
<p><span class="math inline">\(HC_3\)</span> Errors (Davidson and MacKinnon, 1993): <span class="math inline">\(\Sigma = diag \{ \big( \frac{\hat{u_i}}{1-h_i} \big)^2 \}\)</span></p>
<ul>
<li><p>Approximation of the jackknife covariance estimator</p></li>
<li><p>Recommended in some studies over <span class="math inline">\(HC_1\)</span> because it is better at keeping nominal size with only a small loss of power in the presence of heteroskedasticity.</p></li>
</ul>
<p><br></p>
<div id="heteroskedasticity-robust-errors-example" class="section level4">
<h4>Heteroskedasticity-robust errors example</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cex_reg &lt;-<span class="st"> </span><span class="kw">lm</span>(expenditures <span class="op">~</span><span class="st"> </span>hh_size <span class="op">+</span><span class="st"> </span>educ_ref <span class="op">+</span><span class="st"> </span>
<span class="st">                </span>region, <span class="dt">data=</span>cex_data)
<span class="kw">tidy</span>(<span class="kw">coeftest</span>(cex_reg, <span class="dt">vcov =</span> 
                <span class="kw">vcovHC</span>(cex_reg, <span class="dt">type=</span><span class="st">&quot;HC1&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)   -553.      94.1      -5.88 4.13e- 9
## 2 hh_size       -298.      14.3     -20.9  4.33e-97
## 3 educ_ref       109.       7.19     15.2  2.57e-52
## 4 region          83.2     15.3       5.44 5.21e- 8</code></pre>
<p><br></p>
</div>
</div>
<div id="computing-marginal-effects" class="section level3">
<h3>Computing marginal effects</h3>
<p>In linear regressions where the regressors and regressors are in “levels”, the coefficients are of course equal to the marginal effects.</p>
<ul>
<li><p>But if the regression is nonlinear or a regressor enter in e.g. in logs or quadratics, then marginal effects may be more important than coefficients.</p></li>
<li><p>You can use the package <a href="https://www.rdocumentation.org/packages/margins/versions/0.3.0">margins</a> to get marginal effects.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;margins&quot;)</span>
<span class="kw">library</span>(margins)</code></pre></div>
<p><br></p>
<div id="marginal-effects-example" class="section level4">
<h4>Marginal effects example</h4>
<p>We can get the Average Marginal Effects by using <code>summary</code> with <strong>margins</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">margins</span>(wages_reg))</code></pre></div>
<pre><code>##     factor     AME     SE        z      p   lower   upper
##      exper  0.1209 0.0232   5.2072 0.0000  0.0754  0.1664
##  schooling  0.6422 0.0334  19.2256 0.0000  0.5768  0.7077
##  sexfemale -1.3391 0.1077 -12.4298 0.0000 -1.5503 -1.1279</code></pre>
<p><br> <br></p>
</div>
</div>
</div>
<div id="further-regression-methods" class="section level2">
<h2>Further regression methods</h2>
<div id="panel-regression-first-differences" class="section level3">
<h3>Panel regression: first differences</h3>
<p>The package <a href="https://www.rdocumentation.org/packages/plm">plm</a> provides a wide variety of estimation methods and diagnostics for panel data.</p>
<ul>
<li><p>We will cover two common panel data estimators, first-differences regression and fixed effects regression.</p></li>
<li><p>To estimate first-differences estimator, use the <a href="https://www.rdocumentation.org/packages/plm/versions/1.6-5/topics/plm">plm()</a> in the plm package.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(plm)</code></pre></div>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myreg &lt;-<span class="st"> </span><span class="kw">plm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span>x3, <span class="dt">data =</span> mydata,
          <span class="dt">index=</span><span class="kw">c</span>(<span class="st">&quot;groupvar&quot;</span>, <span class="st">&quot;timevar&quot;</span>), <span class="dt">model=</span><span class="st">&quot;fd&quot;</span>)</code></pre></div>
<p><br></p>
</div>
<div id="panel-regression-fixed-effects" class="section level3">
<h3>Panel regression: fixed effects</h3>
<p>Of course, in most cases fixed effects regression is a more efficient alternative to first-difference regression.</p>
<p>To use fixed effects regression, instead specify the argument <strong>model = “within”</strong>.</p>
<ul>
<li>Use the option <strong>effect = “twoway”</strong> to include group and year fixed effects.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myreg &lt;-<span class="st"> </span><span class="kw">plm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span>x3, <span class="dt">data =</span> mydata, 
             <span class="dt">index=</span><span class="kw">c</span>(<span class="st">&quot;groupvar&quot;</span>, <span class="st">&quot;timevar&quot;</span>), 
             <span class="dt">model=</span><span class="st">&quot;within&quot;</span>, <span class="dt">effect =</span> <span class="st">&quot;twoway&quot;</span>)</code></pre></div>
<p><br></p>
<div id="a-crime-example" class="section level4">
<h4>A crime example</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">crime_NC &lt;-<span class="st"> </span>Crime <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(county, year, crmrte, polpc, region, smsa, 
  taxpc) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">crimerate=</span>crmrte, 
  <span class="dt">police_pc =</span> polpc, <span class="dt">urban=</span>smsa, <span class="dt">tax_pc=</span>taxpc)
crime_NC[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,]</code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   county  year crimerate police_pc region  urban tax_pc
##    &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt;  &lt;dbl&gt;
## 1      1    81    0.0399   0.00179 central no      25.7
## 2      1    82    0.0383   0.00177 central no      24.9</code></pre>
<p><br></p>
<div id="first-differences-regression-on-the-crime-dataset" class="section level5">
<h5>First differences regression on the crime dataset</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">crime_reg &lt;-<span class="st"> </span><span class="kw">plm</span>(crimerate <span class="op">~</span><span class="st"> </span>police_pc <span class="op">+</span><span class="st"> </span>tax_pc <span class="op">+</span>
<span class="st">                </span>region <span class="op">+</span><span class="st"> </span>urban, <span class="dt">data=</span>crime_NC, 
                <span class="dt">index=</span><span class="kw">c</span>(<span class="st">&quot;county&quot;</span>, <span class="st">&quot;year&quot;</span>), <span class="dt">model=</span><span class="st">&quot;fd&quot;</span>)
<span class="kw">tidy</span>(crime_reg)</code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   term          estimate std.error statistic  p.value
##   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept) 0.000129   0.000374     0.345  7.30e- 1
## 2 police_pc   2.06       0.200       10.3    6.84e-23
## 3 tax_pc      0.00000108 0.0000515    0.0210 9.83e- 1</code></pre>
<p><br></p>
</div>
<div id="fixed-effects-regression-on-the-crime-dataset" class="section level5">
<h5>Fixed effects regression on the crime dataset</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">crime_reg &lt;-<span class="st"> </span><span class="kw">plm</span>(crimerate <span class="op">~</span><span class="st"> </span>police_pc <span class="op">+</span>
<span class="st">                </span>tax_pc <span class="op">+</span><span class="st"> </span>urban, <span class="dt">data=</span>crime_NC, 
                <span class="dt">index=</span><span class="kw">c</span>(<span class="st">&quot;county&quot;</span>, <span class="st">&quot;year&quot;</span>), 
                <span class="dt">model=</span><span class="st">&quot;within&quot;</span>, <span class="dt">effect=</span><span class="st">&quot;twoway&quot;</span>)
<span class="kw">tidy</span>(crime_reg)</code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term       estimate std.error statistic  p.value
##   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 police_pc 1.78      0.144         12.4  4.71e-31
## 2 tax_pc    0.0000627 0.0000450      1.39 1.65e- 1</code></pre>
<p><br></p>
</div>
</div>
</div>
<div id="instrumental-variables-regression" class="section level3">
<h3>Instrumental variables regression</h3>
<p>The most popular function for doing IV regression is the <a href="https://www.rdocumentation.org/packages/AER/versions/1.2-5/topics/ivreg">ivreg()</a> in the <a href="https://www.rdocumentation.org/packages/AER">AER package</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(AER)</code></pre></div>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">myivreg &lt;-<span class="st"> </span><span class="kw">ivreg</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">|</span><span class="st"> </span>z1 <span class="op">+</span><span class="st"> </span>z2 <span class="op">+</span><span class="st"> </span>z3, 
                 <span class="dt">data =</span> mydata)</code></pre></div>
<p><br></p>
<div id="iv-diagnostics" class="section level4">
<h4>IV diagnostics</h4>
<p>Three common diagnostic tests are available with the <strong>summary</strong> output for regression objects from <a href="https://www.rdocumentation.org/packages/AER/versions/1.2-5/topics/ivreg">ivreg()</a>.</p>
<ul>
<li><p><strong>Durbin-Wu-Hausman Test of Endogeneity:</strong> Tests for endogeneity of suspected endogenous regressor under assumption that instruments are exogenous.</p></li>
<li><p><strong>F-Test of Weak Instruments</strong>: Typical rule-of-thumb value of 10 to avoid weak instruments, although you can compare again Stock and Yogo (2005) critical values for more precise guidance concerning statistical size and relative bias.</p></li>
<li><p><strong>Sargan-Hansen Test of Overidentifying Restrictions:</strong> In overidentified case, tests if some instruments are endogenous under the initial assumption that all instruments are exogenous.</p></li>
</ul>
<p><br></p>
</div>
<div id="iv-regression-example" class="section level4">
<h4>IV regression example</h4>
<p>Let’s look at an IV regression from the seminal paper “The Colonial Origins of Comparative Development” by Acemogulu, Johnson, and Robinson (AER 2001)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">col_origins &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;./data/maketable5.dta&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">as.tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(baseco<span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(logpgp95, avexpr, logem4, shortnam) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">logGDP95 =</span> logpgp95, <span class="dt">country =</span> shortnam,
    <span class="dt">legalprotect =</span> avexpr, <span class="dt">log.settler.mort =</span> logem4)

col_origins_iv &lt;-<span class="st"> </span><span class="kw">ivreg</span>(logGDP95 <span class="op">~</span><span class="st"> </span>legalprotect <span class="op">|</span><span class="st"> </span>
<span class="st">      </span>log.settler.mort, <span class="dt">data =</span> col_origins)</code></pre></div>
<p><strong>Estimates:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">IVsummary &lt;-<span class="st"> </span><span class="kw">summary</span>(col_origins_iv, <span class="dt">diagnostics =</span> <span class="ot">TRUE</span>)

IVsummary[<span class="st">&quot;coefficients&quot;</span>]</code></pre></div>
<pre><code>## $coefficients
##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept)  1.9096665  1.0267273 1.859955 6.763720e-02
## legalprotect 0.9442794  0.1565255 6.032753 9.798645e-08</code></pre>
<p><strong>Diagnostics:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">IVsummary[<span class="st">&quot;diagnostics&quot;</span>]</code></pre></div>
<pre><code>## $diagnostics
##                  df1 df2 statistic      p-value
## Weak instruments   1  62  22.94680 1.076546e-05
## Wu-Hausman         1  61  24.21962 6.852437e-06
## Sargan             0  NA        NA           NA</code></pre>
<p><br></p>
</div>
</div>
<div id="further-regression-methods-1" class="section level3">
<h3>Further regression methods</h3>
<p>Some useful functions for nonlinear regression include:</p>
<ul>
<li><p><strong>Quantile Regression:</strong> <a href="https://www.rdocumentation.org/packages/quantreg/versions/5.34/topics/rq">rq()</a> in the <a href="https://www.rdocumentation.org/packages/quantreg/">quantreg</a> package.</p></li>
<li><p><strong>Limited Dependent Variable Models:</strong></p>
<ul>
<li><p>These models, such as logit and probit (binary choice), or Poisson (count model) are incorporated in R as specific cases of a <em>generalized linear model</em> (GLM).</p></li>
<li>GLM models are estimated in R using the <a href="https://www.rdocumentation.org/packages/stats/versions/3.4.3/topics/glm">glm()</a> function in base R.</li>
</ul></li>
<li><p><strong>Regression Discontinutiy:</strong></p>
<ul>
<li>RDD designs can easily be performed in R through a few different packages.</li>
<li>I suggest using the function <a href="https://www.rdocumentation.org/packages/rdrobust/versions/0.98/topics/rdrobust">rdrobust()</a> from the package of the same name.</li>
</ul></li>
</ul>
<p><br> <br></p>
</div>
</div>
<div id="graphs-in-r" class="section level2">
<h2>Graphs in R</h2>
<div id="data-visualization-overview" class="section level3">
<h3>Data visualization overview</h3>
<p>One of the strong points of R is creating very high-quality data visualization.</p>
<ul>
<li><p>R is very good at both “static” data visualization and interactive data visualization designed for web use.</p></li>
<li><p>Today, I will be covering static data visualization, but here are a couple of good resources for interactive visualization: [<a href="http://www.rebeccabarter.com/blog/2017-04-20-interactive/">1</a>], [<a href="https://www.r-graph-gallery.com/get-the-best-from-ggplotly/">2</a>]</p></li>
</ul>
<p><br></p>
</div>
<div id="ggplot2-for-data-visualization" class="section level3">
<h3>ggplot2 for data visualization</h3>
<p>The main package for publication-quality static data visualization in R is <a href="https://www.rdocumentation.org/packages/ggplot2">ggplot2</a>, which is part of the tidyverse collection of packages.</p>
<ul>
<li><p>The workhorse function of ggplot2 is <a href="https://www.rdocumentation.org/packages/ggplot2/versions/2.2.1/topics/ggplot">ggplot()</a>, response for creating a very wide variety of graphs.</p></li>
<li><p>The “gg” stands for “grammar of graphics”. In each <a href="https://www.rdocumentation.org/packages/ggplot2/versions/2.2.1/topics/ggplot">ggplot()</a> call, the appearance of the graph is determined by specifying:</p>
<ul>
<li>The <strong>data</strong>(frame) to be used.</li>
<li>The <strong>aes</strong>(thetics) of the graph — like size, color, x and y variables.</li>
<li>The <strong>geom</strong>(etry) of the graph — type of data to be used.</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mygraph &lt;-<span class="st"> </span><span class="kw">ggplot</span>(mydata, <span class="kw">aes</span>(...)) <span class="op">+</span><span class="st"> </span><span class="kw">geom</span>(...) <span class="op">+</span><span class="st"> </span>... </code></pre></div>
<p><br></p>
</div>
<div id="scatterplots" class="section level3">
<h3>Scatterplots</h3>
<p>First, let’s look at a simple scatterplot, which is defined by using the geometry <strong>geom_point()</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(col_origins, <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect, 
            <span class="dt">y =</span> logGDP95)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() </code></pre></div>
<p><img src="all_files/figure-html/scatter-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="adding-an-aesthetic-option-to-the-points" class="section level3">
<h3>Adding an aesthetic option to the points</h3>
<p>Graphs can be extensively customized using additional arguments inside of elements:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(col_origins, <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect,<span class="dt">y =</span> logGDP95)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size=</span>logGDP95))</code></pre></div>
<p><img src="all_files/figure-html/aesth-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="using-country-names-instead-of-points" class="section level3">
<h3>Using country names instead of points</h3>
<p>Instead of using a scatter plot, we could use the names of the data points in place of the dots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(col_origins, 
       <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect, <span class="dt">y =</span> logGDP95, 
       <span class="dt">label=</span>country)) <span class="op">+</span><span class="st">  </span><span class="kw">geom_text</span>()</code></pre></div>
<p><img src="all_files/figure-html/countrynames-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="line-graph" class="section level3">
<h3>Line graph</h3>
<p>A line graph uses the geometry <strong>geom_line()</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(col_origins, <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect, <span class="dt">y =</span> logGDP95))  <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() </code></pre></div>
<p><img src="all_files/figure-html/line-1.png" width="672" /></p>
<p><br></p>
<div id="plotting-a-regression-line" class="section level4">
<h4>Plotting a regression line</h4>
<p>A more useful line is the fitted values from the regression. Here’s a plot of that line with the points from the scatterplot for the Acemoglu IV:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">col_origins_fitted &lt;-<span class="st"> </span><span class="kw">tibble</span>(col_origins<span class="op">$</span>legalprotect, 
                             <span class="kw">fitted</span>(col_origins_iv))
<span class="kw">colnames</span>(col_origins_fitted) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;legalprotect&quot;</span>, <span class="st">&quot;hat&quot;</span>)

<span class="kw">ggplot</span>(col_origins, <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect, <span class="dt">y =</span> logGDP95))  <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color=</span><span class="st">&quot;red&quot;</span>)  <span class="op">+</span><span class="st">  </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> col_origins_fitted, <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect, <span class="dt">y=</span>hat)) </code></pre></div>
<p><img src="all_files/figure-html/regline-1.png" width="672" /></p>
<p><br></p>
</div>
</div>
<div id="specifying-axis-and-titles" class="section level3">
<h3>Specifying axis and titles</h3>
<p>A standard task in making the graph is specifying graph titles (main and axes), as well as potentially specifying the scale of the axes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(col_origins, <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect, <span class="dt">y =</span> logGDP95))  <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color=</span><span class="st">&quot;red&quot;</span>)  <span class="op">+</span><span class="st">  </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> col_origins_fitted, <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect, <span class="dt">y=</span>hat))  <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;GDP and Legal Protection&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Legal Protection Index [0-10]&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Log of 1995 GDP&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="dv">0</span>, <span class="dv">10</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">5</span>,<span class="dv">10</span>)</code></pre></div>
<pre><code>## Warning: Removed 3 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 5 rows containing missing values (geom_path).</code></pre>
<p><img src="all_files/figure-html/titles-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="histogram" class="section level3">
<h3>Histogram</h3>
<p>The geometry point for histogram is <strong>geom_histogram()</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(col_origins, <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Histogram of Legal Protection Scores&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Legal Protection Index [0-10]&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;# of Countries&quot;</span>) </code></pre></div>
<p><img src="all_files/figure-html/histo-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="bar-plot" class="section level3">
<h3>Bar plot</h3>
<p>The geometry for a bar plot is <strong>geom_bar()</strong>. By default, a bar plot uses frequencies for its values, but you can use values from a column by specifying <strong>stat = “identity”</strong> inside <strong>geom_bar()</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coeffs_IV &lt;-<span class="st"> </span><span class="kw">tidy</span>(col_origins_iv)

<span class="kw">ggplot</span>(coeffs_IV, 
  <span class="kw">aes</span>(<span class="dt">x=</span>term, <span class="dt">y=</span>estimate)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Parameter Estimates for Colonial Origins&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Parameter&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Estimate&quot;</span>)</code></pre></div>
<p><img src="all_files/figure-html/bar-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="adding-error-bars" class="section level3">
<h3>Adding error bars</h3>
<p>You can easily add error bars by specifying the values for the error bar inside of <strong>geom_errorbar()</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(coeffs_IV, 
  <span class="kw">aes</span>(<span class="dt">x=</span>term, <span class="dt">y=</span>estimate)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Parameter Estimates for Colonial Origins&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Parameter&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Estimate&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>estimate <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>std.error, 
                  <span class="dt">ymax=</span>estimate <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>std.error), 
                  <span class="dt">size=</span>.<span class="dv">75</span>, <span class="dt">width=</span>.<span class="dv">3</span>, <span class="dt">color=</span><span class="st">&quot;red3&quot;</span>)</code></pre></div>
<p><img src="all_files/figure-html/errorbar-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="adding-colors" class="section level3">
<h3>Adding colors</h3>
<p>You can easily add color to graph points as well. There are a lot of aesthetic options to do that — here I demonstrate adding a color <em>scale</em> to the graph.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(col_origins, <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect, 
  <span class="dt">y =</span> logGDP95 , <span class="dt">col=</span> log.settler.mort)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;GDP and Legal Protection&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Legal Protection Index [0-10]&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Log of 1995 GDP&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_color_gradient</span>(<span class="dt">low=</span><span class="st">&quot;green&quot;</span>,<span class="dt">high=</span><span class="st">&quot;red&quot;</span>, 
                       <span class="dt">name=</span><span class="st">&quot;Log Settler Mortality&quot;</span>)</code></pre></div>
<p><img src="all_files/figure-html/colors1-1.png" width="672" /></p>
<p><br></p>
<div id="adding-colors-example-2" class="section level4">
<h4>Adding colors: example 2</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(col_origins, <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;red2&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Histogram of Legal Protection Scores&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Legal Protection Index [0-10]&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;# of Countries&quot;</span>) </code></pre></div>
<p><img src="all_files/figure-html/unnamed-chunk-99-1.png" width="672" /></p>
<p><br></p>
</div>
</div>
<div id="adding-themes" class="section level3">
<h3>Adding themes</h3>
<p>Another option to affect the appearance of the graph is to use <strong>themes</strong>, which affect a number of general aspects concerning how graphs are displayed.</p>
<ul>
<li>Some default themes come installed with ggplot2/tidyverse, but some of the best in my opinion come from the package <a href="https://github.com/jrnold/ggthemes">ggthemes</a>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggthemes)</code></pre></div>
<ul>
<li>To apply a theme, just add <strong>+ themename()</strong> to your ggplot graphic.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(col_origins, <span class="kw">aes</span>(<span class="dt">x=</span>legalprotect)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">col=</span><span class="st">&quot;white&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;red2&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Histogram of Legal Protection Scores&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Legal Protection Index [0-10]&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;# of Countries&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_economist</span>()</code></pre></div>
<p><img src="all_files/figure-html/themeex-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="more-with-ggplot2" class="section level3">
<h3>More with ggplot2</h3>
<p>This has been just a small overview of things you can do with ggplot2. To learn more about it, here are some useful references:</p>
<p><a href="http://ggplot2.tidyverse.org/"><strong>The ggplot2 website:</strong></a></p>
<ul>
<li>Very informative although if you don’t know what you’re looking for, you can be a bit inundated with information.</li>
</ul>
<p><a href="http://www.sthda.com/english/wiki/ggplot2-essentials"><strong>STHDA Guide to ggplot2:</strong></a></p>
<ul>
<li>A bit less detailed, but a good general guide to ggplot2 that is still pretty thorough.</li>
</ul>
<p><strong><a href="https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf">RStudio’s ggplot2 cheat sheet</a>:</strong></p>
<ul>
<li>As with all the cheat sheets, very concise but a great short reference to main options in the package.</li>
</ul>
<p><br> <br></p>
</div>
</div>
</div>
<div id="intro-to-bayesian-analysis" class="section level1">
<h1><strong>Intro to Bayesian analysis</strong></h1>
<p><br></p>
<div id="conceptual-introduction" class="section level2">
<h2>Conceptual Introduction</h2>
<p><br></p>
<div id="thought-experiment" class="section level3 tabset tabset-pills">
<h3><strong>Thought Experiment</strong></h3>
<div id="question" class="section level4">
<h4>Question</h4>
<p>Imagine I’m conducting a raffle. I have a large bowl, and inside of it are many raffle entries, each with different numbers on them.</p>
<ul>
<li><p>Let the variable <em>x</em> represent the number drawn from the bowl.</p></li>
<li><p>Before reaching into the bowl, I want to know:</p>
<p><em>‘’What is the probability that I’m going to pick up a number less than 10 from the bowl?’’</em></p></li>
<li><p>That is, what is <span class="math inline">\(p(x \leq 10)\)</span>?</p>
<ul>
<li><strong><em>Does this probability change if I tell you that all the numbers in the bowl have at least 3 digits (ie are <span class="math inline">\(\geq 100\)</span>)?</em></strong></li>
</ul></li>
</ul>
<p><br> <br></p>
</div>
<div id="answer" class="section level4">
<h4>Answer</h4>
<p><strong>Classical Statistics:</strong> <em>No.</em></p>
<ul>
<li><p>Probability is defined as: <span class="math inline">\(\lim_{n \rightarrow \infty} \frac{n_S}{n}\)</span>, where <span class="math inline">\(n\)</span> is the number of times I repeat the experiment and <span class="math inline">\(n_S\)</span> is the number of times a number <span class="math inline">\(x \leq 10\)</span> is drawn.</p></li>
<li><p><span class="math inline">\(p(x \leq 10)\)</span> was always equal to zero, all that changed was your knowledge of the experiment.</p></li>
</ul>
<p><strong>Bayesian Statistics:</strong> <em>Almost certainly.</em></p>
<ul>
<li><p>Probability is a measure of subjective belief about how likely an event is, based on prior understanding and new information.</p></li>
<li><p>Prior <span class="math inline">\(\rightarrow\)</span> Information <span class="math inline">\(\rightarrow\)</span> Posterior</p></li>
</ul>
<p><br> <br></p>
</div>
</div>
<div id="epistomological-difference" class="section level3">
<h3><strong>Epistomological difference</strong></h3>
<ul>
<li><p>Bayesian statistics integrates the epistemological uncertainty of statistical estimation into its core procedures. It’s fundamental goal is to assess and improve the accuracy of one’s beliefs based on a set of identifying statistical assumptions.</p></li>
<li><p>Classical statistics attempts to instead conduct inference on the (unknown) underlying reality, based on its own set of identifying assumptions.</p></li>
</ul>
<p><strong><em>NOT mutually exclusive</em></strong></p>
<p><br></p>
</div>
<div id="bayes-rule" class="section level3">
<h3><strong>Bayes Rule</strong></h3>
<p>The cornerstone of the Bayesian approach (and the source of its name) is the conditional likelihood theorem known as <strong>Bayes’ rule</strong>.</p>
<p>In its simplest form, Bayes’ Rule states that for two events and A and B (with <span class="math inline">\(P(B) \neq 0\)</span>): <span class="math display">\[ P(A|B) = \frac{P(B|A)P(A)}{P(B)} \]</span></p>
<p>Or, if A can take on multiple values, we have the <strong>extended form</strong>:</p>
<p><span class="math display">\[ p(A_i|B) = \frac{p(B | A_i) P(A_i)}{\sum_j P(B|A_j)P(A_j)} \]</span></p>
<p><br></p>
</div>
<div id="inference-using-bayes-rule" class="section level3">
<h3><strong>Inference using Bayes’ Rule</strong></h3>
<p>Adapting Bayes’ Rule to the case of a parameter value, <span class="math inline">\(\theta\)</span> and observed data <em>y</em>, we have:</p>
<p><span class="math display">\[ p(\theta \mid y) = \frac{f(\theta, y)}{f(y)} =  \frac{f(y\mid\theta)p(\theta)}{ \int f(y \mid \theta) p(\theta) d\theta} \underbrace{\propto}_{\text{proportional to}} f(y|\theta)p(\theta) \]</span></p>
<p>Adding a bit of terminology:</p>
<ul>
<li><span class="math inline">\(p(\theta)\)</span> is the <strong>prior</strong> distribution: our initial subjective belief about the probability distribution of <span class="math inline">\(\theta\)</span>.</li>
<li><p><span class="math inline">\(f(y|\theta)\)</span> you may recognize from Maximum Likelihood estimation as:</p>
<ul>
<li><span class="math inline">\(f(y | \theta) = \prod_{i=1}^n f(y_i |\theta) = \mathcal{L} (\theta)\)</span>, the <strong>likelihood function</strong>.</li>
</ul></li>
<li><p>Finally, <span class="math inline">\(p(\theta)|y)\)</span> is our <strong>posterior</strong> (post-experiment) belief     about the probability distribution of <span class="math inline">\(\theta\)</span>.</p></li>
</ul>
<p><span class="math display">\[ \overbrace{p(\theta \mid y)}^{\text{posterior}} = \frac{\overbrace{f(y\mid\theta)}^\text{likelihood} \overbrace{p(\theta)}^\text{prior}}{\underbrace{\int f(y \mid \theta) p(\theta) d\theta}_\text{average likelihood}}  \underbrace{\propto}_{\text{proportional to}} \overbrace{f(y|\theta)}^{likelihood} \overbrace{p(\theta)}^{prior}\]</span></p>
<p>Hence we have the basic statement:</p>
<p><span class="math display">\[ Posterior \propto Likelihood \times Prior \]</span></p>
<ul>
<li>This is commonly summarized as saying that the posterior     belief is a compromise between the data and prior belief.</li>
</ul>
<p><br></p>
</div>
<div id="priors" class="section level3">
<h3><strong>Priors</strong></h3>
<p>Given this <em>compromise with prior beliefs</em>, Bayesian analysis is often attacked as subjective and a lot of emphasis is placed on the role of prior beliefs. <strong>But fear not!</strong></p>
<ul>
<li><p>First, as the data sample increases, the data becomes the determining factor of the posterior probability.</p></li>
<li><p>Moreover, if desired, we can easily specify priors that have <em>no effect</em> on the posterior estimates.</p></li>
</ul>
<p><br></p>
<div id="types-of-priors" class="section level4">
<h4><strong>Types of Priors</strong></h4>
<p>Different types of priors include:</p>
<ul>
<li><p><strong>Uninformative (or “flat”) priors</strong>: Priors that have no impact on posterior values (ie assuming total ignorance about the possible parameter value).</p>
<ul>
<li>A classic uninformative prior is the uniform prior, which treats all possible parameter values as equally likely: <span class="math inline">\(p(\theta) = c \text{ } \forall \theta \in \Theta\)</span></li>
</ul></li>
<li><p><strong>Informative priors</strong>: Priors where we use prior knowledge to specify a prior with a best-guess of the prior mean and distribution for a parameter value.</p></li>
<li><p><strong>Weakly informative</strong> or <strong>regularizing priors</strong>: Priors which are deliberately less informative than our actual knowledge, affecting estimates less than informative priors but at least incorporating <em>very conservative</em> information into the    production of posterior estimates.</p></li>
</ul>
<p><br></p>
</div>
<div id="intuition-about-priors" class="section level4">
<h4><strong>Intuition about priors</strong></h4>
<p>Think for instance of inference about possible life expectancy:</p>
<ul>
<li><p>We could specify an uninformative prior that says allows for any possible lifespan (even living to 1 million years old).</p></li>
<li><p>We could specify some skewed normal distribution that approximates our current estimates of the distribution of current lifespans.</p></li>
<li><p>Or we could specify some weaker prior that for instance allows life expectancy to be more dispersed and ages to reach, say 150 or 200 years old.</p>
<ul>
<li>Weakly informative priors don’t use our best understanding of life expectancy, but at least “tells” our analysis that some possibilities are very implausible.</li>
</ul></li>
</ul>
<p><strong><em>In almost all circumstances, a weak prior should be preferred.</em></strong></p>
<p><br></p>
</div>
<div id="priors-example" class="section level4">
<h4><strong>Priors Example:</strong></h4>
<div class="figure">
<img src="priors.png" alt="From van de Schoot et al 2014" />
<p class="caption">From van de Schoot et al 2014</p>
</div>
<p><br> <br> ### <strong>Hypothesis Testing in Bayesian Analysis?</strong></p>
<p>Another point of divergence for Bayesian vs. frequentist data analysis is even more dramatic:</p>
<ul>
<li><p>Largely, there is no place for null-hypothesis significance testing (NHST) in Bayesian analysis</p>
<ul>
<li><p>Bayesian analysis has <em>something</em> similar called a <strong>Bayes’ factor</strong>, which essentially assigns a prior probability to the likilihood ratio of a null and alternative model and then estimates it’s posterior probability.</p></li>
<li><p>But Bayes factors are heavily criticized by leading Bayesians like Andrew Gelman and Donald Rubin, because it is highly sensitive to prior probabilities and model structures, among other issues.</p></li>
</ul></li>
<li><p>Instead, analysis is oriented around estimation of the posterior distribution of parameters (or predictions).</p></li>
</ul>
<p><br></p>
</div>
<div id="bayesian-inference-with-credible-intervals" class="section level4">
<h4><strong>Bayesian Inference with Credible Intervals</strong></h4>
<p>Without NHST to tell us if our results are significant, does that mean we just get point estimates and no way to assess how reliable they are? <strong><em>No!</em></strong></p>
<ul>
<li><p>Recall that we are estimating the posterior <em>distribution</em> of a parameter (or predicted outcome).</p></li>
<li><p>Hence, we can easily produce a 95% interval for the parameter, simply using the quantiles of the posterior CDF.</p></li>
</ul>
<p>In Bayesian analysis, we replace the 100(<span class="math inline">\(1-\alpha\)</span>)% frequentist confidence interval with the 100(<span class="math inline">\(1-\alpha\)</span>)% <strong>credible interval</strong>.</p>
<p>A credible interval, however, has a much more appealing interpretation than a confidence interval.</p>
<ul>
<li><p>A confidence interval has the interpretation that, in repeated samples, the true parameter lies within the confidence region 95% of the time.</p></li>
<li><p>A credible interval is what people <em>think</em> a confidence interval should mean: there is a 95% chance that the true value lies within the 95% credible interval.</p></li>
</ul>
<p><br></p>
</div>
</div>
<div id="bayesian-computation" class="section level3">
<h3><strong>Bayesian Computation</strong></h3>
<p>One major feature of Bayesian inference that I haven’t mentioned so far is the intractability of analytic solutions for estimating posterior distributions in most circumstances.</p>
<p>Recall: <span class="math display">\[ p(\theta \mid y) = \frac{f(\theta, y)}{f(y)} =  \frac{f(y\mid\theta)p(\theta)}{ \int f(y \mid \theta) p(\theta) d\theta} \]</span></p>
<p>For models that are more complex or that involve high-dimensional data, closed-form solutions are not available for the integral in the denominator.</p>
<p>Hence, Bayesian analysis instead typically relies on numerical methods, usually Markov Chain Monte Carlo (MCMC) methods.</p>
<p><br></p>
<div id="mcmc-methods" class="section level4">
<h4><strong>MCMC Methods</strong></h4>
<p>This method relies on sequentially sampling values of <span class="math inline">\(\theta\)</span> from an approximation of the posterior distribution and then correcting the approximation to create better subsequent samples.</p>
<ul>
<li><p>Because the approximated distribution used in 1 step relies on the sample from the previous step, the simulation forms a <strong>Markov chain</strong>.</p></li>
<li><p>A critical property then is <strong>convergence</strong>: Have our simulations converged to the real target distribution?</p>
<ul>
<li>Typically instead of running one really long “chain”, researchers use multiple short chains.<br />
</li>
<li>The aggregate can not only converge faster, but can provide a better sense of convergence through the noisiness between multiple chains.</li>
</ul></li>
</ul>
<p><br></p>
</div>
</div>
</div>
<div id="bayesian-regression-with-rstanarm" class="section level2">
<h2>Bayesian Regression with rstanarm</h2>
<div id="stan" class="section level3">
<h3><strong>Stan</strong></h3>
<p>Probably the best approach to doing Bayesian analysis in any software environment is with <a href="https://www.rdocumentation.org/packages/rstan">rstan</a>, which is an R interface to the Stan programming language designed for Bayesian analysis.</p>
<ul>
<li><p>To use <a href="https://www.rdocumentation.org/packages/rstan">rstan</a>, you will first need to install <strong>RTools</strong> from <a href="https://github.com/stan-dev/rstan/wiki/Installing-RStan-on-Windows">this link</a>.</p></li>
<li><p>Then install the package <a href="https://www.rdocumentation.org/packages/rstan">rstan</a> from RStudio (make sure to set <code>dependencies=TRUE</code> when installing).</p></li>
</ul>
<p><br></p>
<div id="parallelization-support" class="section level4">
<h4><strong>Parallelization support</strong></h4>
<p>Once you’ve setup <a href="https://www.rdocumentation.org/packages/rstan">rstan</a>, there is one more thing you should typically do: tell it to run on multiple cores.</p>
<ul>
<li>rstan includes support for basic parallelization that speeds up execution tremendous for larger / more complex regressions.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rstan)
<span class="kw">rstan_options</span> (<span class="dt">auto_write=</span><span class="ot">TRUE</span>)
<span class="co"># Run on multiple cores</span>
<span class="kw">options</span> (<span class="dt">mc.cores=</span>parallel<span class="op">::</span><span class="kw">detectCores</span> ()) </code></pre></div>
<p><br></p>
</div>
<div id="a-stan-regression-example" class="section level4">
<h4><strong>A Stan regression example</strong></h4>
<p>Now that you’re <strong><em>hopefully</em></strong> excited about rstan, let’s look at an example of a rstan regression from the package documentation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create schools.stan --------------------------</span>
data {
  int<span class="op">&lt;</span>lower=<span class="dv">0</span><span class="op">&gt;</span><span class="st"> </span>J;       <span class="op">/</span><span class="er">/</span><span class="st"> </span>number of schools 
  real y[J];            <span class="op">/</span><span class="er">/</span><span class="st"> </span>estimated treatment effects
  real<span class="op">&lt;</span>lower=<span class="dv">0</span><span class="op">&gt;</span><span class="st"> </span>sigma[J]; <span class="op">/</span><span class="er">/</span><span class="st"> </span>s.e. of effect estimates 
}
parameters {
  real mu; 
  real<span class="op">&lt;</span>lower=<span class="dv">0</span><span class="op">&gt;</span><span class="st"> </span>tau;
  vector[J] eta;
}

## Still creating schools.stan
transformed parameters {
  vector[J] theta;
  theta =<span class="st"> </span>mu <span class="op">+</span><span class="st"> </span>tau <span class="op">*</span><span class="st"> </span>eta;
}

model {
  target <span class="op">+</span><span class="er">=</span><span class="st"> </span><span class="kw">normal_lpdf</span>(eta <span class="op">|</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span>);
  target <span class="op">+</span><span class="er">=</span><span class="st"> </span><span class="kw">normal_lpdf</span>(y <span class="op">|</span><span class="st"> </span>theta, sigma);
}
<span class="co"># End of schools.stan --------------------------</span>

## Run Stan regression using schools.stan
fit1 &lt;-<span class="st"> </span><span class="kw">stan</span>(
  <span class="dt">file =</span> <span class="st">&quot;schools.stan&quot;</span>, <span class="co"># Stan program</span>
  <span class="dt">data =</span> schools_data,    <span class="co"># named list of data</span>
  <span class="dt">chains =</span> <span class="dv">4</span>,             <span class="co"># number of Markov chains</span>
  <span class="dt">warmup =</span> <span class="dv">1000</span>,          <span class="co"># number of warmup iterations per chain</span>
  <span class="dt">iter =</span> <span class="dv">2000</span>,            <span class="co"># total number of iterations per chain</span>
  <span class="dt">cores =</span> <span class="dv">2</span>,              <span class="co"># number of cores (using 2 just for the vignette)</span>
  <span class="dt">refresh =</span> <span class="dv">1000</span>          <span class="co"># show progress every &#39;refresh&#39; iterations</span>
  )</code></pre></div>
<p><br></p>
</div>
</div>
<div id="rstanarm-making-rstan-easy" class="section level3">
<h3><strong>Rstanarm: making RStan easy</strong></h3>
<p><strong><em>Oops! That was a lot of code!</em></strong> And there’s still a bit more left out. Luckily, there are a couple of packages that exist to make your life easier:</p>
<ul>
<li><p>First, there is <a href="https://www.rdocumentation.org/packages/rstanarm">rstanarm</a>, which was created by the developers of Stan and rstan to make running a Bayesian regression with rstan much more like you would run a normal frequentist regression.</p></li>
<li><p>Another very similar package to rstanarm is <a href="https://www.rdocumentation.org/packages/brms">brms</a>, which also makes running Bayesian regression much simpler and ‘R-like’.</p></li>
</ul>
<p><br></p>
<div id="short-comparison-of-rstanarm-and-brms" class="section level4">
<h4><strong>Short comparison of rstanarm and brms</strong></h4>
<p><strong>rstanarm</strong> is faster, has better posterior checking, and is a bit simpler to use.</p>
<p><strong>brms</strong> is generally a bit more flexible, with support for some regression types missing in rstanarm, more flexible specification of priors, and support for more types of error correlational structures.</p>
<ul>
<li>My sense is that <a href="https://www.rdocumentation.org/packages/rstanarm">rstanarm</a> is the more popular choice, so that’s what we’ll use here.</li>
</ul>
<p><br></p>
</div>
<div id="using-rstanarm" class="section level4">
<h4><strong>Using rstanarm</strong></h4>
<p>With rstanarm, most regressions you run using the function <a href="https://www.rdocumentation.org/packages/rstanarm/versions/2.17.2/topics/stan_glm">stan_glm()</a></p>
<ul>
<li>Since generalized linear models (GLMs) incorporates models like linear regression, probit, logit, Poisson, binomial, exponential, etc)</li>
</ul>
<p><strong>Syntax:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mybayesreg &lt;-<span class="st"> </span><span class="kw">stan_glm</span>(y <span class="op">~</span><span class="st"> </span>X1 <span class="op">+</span><span class="st"> </span>x2 <span class="op">+</span><span class="st"> </span>x3 ..., 
                       <span class="dt">family =</span> myfamily, <span class="dt">data =</span> mydata, 
                       <span class="dt">prior =</span> myprior)</code></pre></div>
<p><br></p>
</div>
<div id="options-with-stan_glm" class="section level4">
<h4><strong>Options with stan_glm</strong></h4>
<p><strong>Family</strong> (with a possible <strong>link</strong> argument needed as well) defines the type of regression you want:</p>
<ul>
<li>Linear regression: <code>family = gaussian</code></li>
<li>Logit: <code>family = binomial(link = &quot;logit&quot;)</code></li>
<li>Probit: <code>family = binomial(link = &quot;probit&quot;)</code></li>
<li>Poisson: <code>family = poisson</code></li>
<li>More options can be read from the main <a href="https://www.rdocumentation.org/packages/stats/versions/3.4.3/topics/glm">GLM page</a></li>
</ul>
<p><strong>Prior distributions:</strong></p>
<ul>
<li><strong>Flat priors</strong> can be set by using <code>prior = NULL</code></li>
<li><p><em>[Weakly]</em> Informative Priors can be specified by using <code>prior =</code> with one of:</p>
<ul>
<li><em>normal, student_t, cauchy, laplace</em> and more found <a href="https://www.rdocumentation.org/packages/rstanarm/versions/2.17.2/topics/priors">here</a></li>
</ul></li>
</ul>
<p><br></p>
</div>
<div id="a-titanic-survival-example-with-rstanarm" class="section level4">
<h4><strong>A Titanic survival example with rstanarm</strong></h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(Titanic)
<span class="co"># Display titanic data</span>
<span class="kw">glimpse</span>(Titanic,<span class="dt">width =</span> <span class="dv">50</span>)</code></pre></div>
<pre><code>## Observations: 1,313
## Variables: 6
## $ Name     &lt;fct&gt; &quot;Allen, Miss Elisabeth Walton&quot;…
## $ PClass   &lt;fct&gt; 1st, 1st, 1st, 1st, 1st, 1st, …
## $ Age      &lt;dbl&gt; 29.00, 2.00, 30.00, 25.00, 0.9…
## $ Sex      &lt;fct&gt; female, female, male, female, …
## $ Survived &lt;int&gt; 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, …
## $ SexCode  &lt;int&gt; 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, …</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Reformat Class</span>
Titanic<span class="op">$</span>class &lt;-<span class="st"> </span><span class="kw">str_extract</span>(Titanic<span class="op">$</span>PClass, <span class="st">&quot;[0-9]&quot;</span>)

TitanicLinear &lt;-<span class="st"> </span><span class="kw">stan_glm</span>(Survived <span class="op">~</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>
<span class="st">    </span>SexCode <span class="op">+</span><span class="st"> </span><span class="kw">as.factor</span>(class), 
    <span class="dt">data =</span> Titanic, <span class="dt">family =</span> gaussian)

<span class="kw">summary</span>(TitanicLinear)</code></pre></div>
<pre><code>## 
## Model Info:
## 
##  function:     stan_glm
##  family:       gaussian [identity]
##  formula:      Survived ~ Age + SexCode + as.factor(class)
##  algorithm:    sampling
##  priors:       see help(&#39;prior_summary&#39;)
##  sample:       4000 (posterior sample size)
##  observations: 756
##  predictors:   5
## 
## Estimates:
##                     mean   sd     2.5%   25%    50%    75%    97.5%
## (Intercept)          0.6    0.1    0.5    0.6    0.6    0.7    0.7 
## Age                  0.0    0.0    0.0    0.0    0.0    0.0    0.0 
## SexCode              0.5    0.0    0.4    0.5    0.5    0.5    0.6 
## as.factor(class)2   -0.2    0.0   -0.3   -0.2   -0.2   -0.2   -0.1 
## as.factor(class)3   -0.4    0.0   -0.5   -0.4   -0.4   -0.4   -0.3 
## sigma                0.4    0.0    0.4    0.4    0.4    0.4    0.4 
## mean_PPD             0.4    0.0    0.4    0.4    0.4    0.4    0.5 
## log-posterior     -364.8    1.7 -369.0 -365.8 -364.4 -363.5 -362.4 
## 
## Diagnostics:
##                   mcse Rhat n_eff
## (Intercept)       0.0  1.0  2196 
## Age               0.0  1.0  3240 
## SexCode           0.0  1.0  3687 
## as.factor(class)2 0.0  1.0  2403 
## as.factor(class)3 0.0  1.0  2451 
## sigma             0.0  1.0  3833 
## mean_PPD          0.0  1.0  3875 
## log-posterior     0.0  1.0  1852 
## 
## For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
<p><br> <br></p>
<div id="credible-intervals" class="section level6">
<h6><strong>Credible intervals</strong></h6>
<p>You can also easily get print the credible intervals with the function <a href="https://www.rdocumentation.org/packages/rstanarm/versions/2.17.2/topics/posterior_interval.stanreg">posterior_interval()</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posterior_interval</span>(TitanicLinear, <span class="dt">prob=</span><span class="fl">0.95</span>)</code></pre></div>
<pre><code>##                           2.5%        97.5%
## (Intercept)        0.522632399  0.731806400
## Age               -0.008119899 -0.003881513
## SexCode            0.443890662  0.559454186
## as.factor(class)2 -0.281056766 -0.130564031
## as.factor(class)3 -0.466080809 -0.322007081
## sigma              0.369957877  0.409149110</code></pre>
</div>
<div id="graphical-credible-intervals" class="section level5">
<h5><strong>Graphical credible intervals</strong></h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(TitanicLinear)</code></pre></div>
<p><img src="all_files/figure-html/unnamed-chunk-105-1.png" width="672" /></p>
<p><br> <br></p>
</div>
<div id="plotting-the-posterior-distribution" class="section level5">
<h5><strong>Plotting the posterior distribution</strong></h5>
<p>You can also easily plot the posterior distribution of a parameter in R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Titanic_posterior &lt;-<span class="st"> </span>TitanicLinear <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">sec.class =</span> <span class="st">&quot;as.factor(class)2&quot;</span>,
         <span class="dt">third.class =</span> <span class="st">&quot;as.factor(class)3&quot;</span>)

<span class="kw">ggplot</span>(Titanic_posterior, <span class="kw">aes</span>(<span class="dt">x=</span>third.class)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_histogram</span>()</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="all_files/figure-html/unnamed-chunk-106-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="juxtaposing-the-prior-and-the-posterior" class="section level5">
<h5><strong>Juxtaposing the prior and the posterior</strong></h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">posterior_vs_prior</span>(TitanicLinear)</code></pre></div>
<pre><code>## 
## Drawing from prior...</code></pre>
<p><img src="all_files/figure-html/unnamed-chunk-107-1.png" width="672" /></p>
<p><br></p>
</div>
</div>
</div>
</div>
<div id="model-testing-1" class="section level2">
<h2>Model Testing</h2>
<div id="model-testing-basics" class="section level3">
<h3><strong>Model testing basics</strong></h3>
<p>There are a number of different regression diagnostics after performing Bayesian regression to help infer if the model converged, how well it performs, and even compare between models.</p>
<p>Today, we’ll cover some of them included with rstanarm as well as the very useful <a href="https://www.rdocumentation.org/packages/shinystan">shinystan package</a>.</p>
<p><br></p>
</div>
<div id="graphical-posterior-predictive-analysis" class="section level3">
<h3><strong>Graphical posterior predictive analysis</strong></h3>
<p>To check the predictive accuracy of the posterior distribution, you can use the function <a href="https://www.rdocumentation.org/packages/rstanarm/versions/2.17.2/topics/pp_check.stanreg">pp_check()</a>, which plots simulated y values from the posterior distribution against the actual values of y.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pp_check</span>(TitanicLinear)</code></pre></div>
<p><img src="all_files/figure-html/unnamed-chunk-108-1.png" width="672" /></p>
<p><br> <br></p>
</div>
<div id="regularization-and-predictive-accuracy" class="section level3">
<h3><strong>Regularization and Predictive Accuracy</strong></h3>
<p>A critical issue in both Bayesian and frequentist estimation is how to balance predictive accuracy with parsimony. Put another, the researcher should be concerned with not overfitting the data while still creating a compelling model.</p>
<p>The basic approach in frequentist method is to use the Akaike information criterion (AIC):</p>
<p><strong>Expected Log Predictive Density:</strong> <span class="math display">\[\hat{elpd}_{AIC}  =  \log p(y | \hat{\theta}_{MLE}) - k\]</span></p>
<ul>
<li>Where <span class="math inline">\(\theta_{MLE}\)</span> is the maximum likelihood estimator of <span class="math inline">\(\theta\)</span>,</li>
<li><span class="math inline">\(\log p(y | \hat{\theta}_{MLE})\)</span> is the log likelihood given <span class="math inline">\(\theta_{MLE}\)</span>,</li>
<li>and k is the number of parameters in the model.</li>
</ul>
<p><br></p>
<div id="deviance-information-criterion" class="section level4">
<h4><strong>Deviance information criterion</strong></h4>
<p>The most basic Bayesian adaptation of the AIC is the Deviance information criterion (DIC):</p>
<p><span class="math display">\[\hat{elpd}_{DIC}  =  \log p(y | \hat{\theta}_{Bayes}) - p_{DIC}\]</span></p>
<ul>
<li>Where <span class="math inline">\(\theta_{Bayes}\)</span> is the mean posterior estimate and</li>
<li><span class="math inline">\(p_{DIC}\)</span> is the number of “effective parameters in the model” using a data-biased correction</li>
</ul>
<p><br></p>
</div>
<div id="watanabe-akaike-information-criterion" class="section level4">
<h4><strong>Watanabe-Akaike information criterion</strong></h4>
<p>An improvement over the DIC is the Watanabe-Akaike information criterion:</p>
<p><span class="math display">\[\hat{elpd}_{WAIC} = \sum_{i=1}^{n} \log p(y_i) - \sum_{i=1}^{n} \log V \Big[p(y_i) \Big]\]</span></p>
<p>The WAIC has the advantages of:</p>
<ul>
<li><p>Averaging the likelihood over the posterior distribution rather than using the mean</p></li>
<li><p>Does not assume a multivariate Gaussian posterior distribution, as does the DIC (and AIC)</p></li>
</ul>
<p><br></p>
<div id="waic-example" class="section level5">
<h5><strong>WAIC example</strong></h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">waic</span>(TitanicLinear)</code></pre></div>
<pre><code>## 
## Computed from 4000 by 756 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -360.4 19.4
## p_waic         6.0  0.3
## waic         720.9 38.7</code></pre>
<p><br></p>
</div>
</div>
<div id="leave-one-out-cross-validation" class="section level4">
<h4><strong>Leave One Out Cross-Validation</strong></h4>
<p>Another method alongside WAIC for comparing out-of-sample predictive ability is to apply leave-one-out cross-validation (LOO).</p>
<ul>
<li>LOO assesses predictive ability of posterior simulations in which the data is iteratively partitioned into training and prediction sets.</li>
</ul>
<p><strong>Expected Log Predictive Density:</strong><br />
<span class="math display">\[\hat{elpd}_{LOO} = \sum_{i=1}^{n} \log p(y_i | y_{-i})\]</span></p>
<div id="loo-example" class="section level5">
<h5><strong>LOO example</strong></h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loo</span>(TitanicLinear)</code></pre></div>
<pre><code>## 
## Computed from 4000 by 756 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo   -360.5 19.4
## p_loo         6.0  0.3
## looic       720.9 38.7
## ------
## Monte Carlo SE of elpd_loo is 0.0.
## 
## All Pareto k estimates are good (k &lt; 0.5).
## See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p><br></p>
</div>
</div>
<div id="comparing-models" class="section level4">
<h4><strong>Comparing models</strong></h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Titanic_probit &lt;-<span class="st"> </span><span class="kw">stan_glm</span>(Survived <span class="op">~</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>
<span class="st">    </span>SexCode <span class="op">+</span><span class="st"> </span><span class="kw">as.factor</span>(class), 
    <span class="dt">data =</span> Titanic, <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span>probit))
Loo_probit &lt;-<span class="st"> </span><span class="kw">loo</span>(Titanic_probit)

Titanic_logit &lt;-<span class="st"> </span><span class="kw">stan_glm</span>(Survived <span class="op">~</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>
<span class="st">    </span>SexCode <span class="op">+</span><span class="st"> </span><span class="kw">as.factor</span>(class), 
    <span class="dt">data =</span> Titanic, <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span>logit))
Loo_logit &lt;-<span class="st"> </span><span class="kw">loo</span>(Titanic_logit)

<span class="co"># ELPD_diff&gt;0 indicates more support for 2nd model</span>
<span class="kw">compare_models</span>(Loo_probit, Loo_logit)</code></pre></div>
<pre><code>## 
## Model comparison: 
## (negative &#39;elpd_diff&#39; favors 1st model, positive favors 2nd) 
## 
## elpd_diff        se 
##       1.4       0.8</code></pre>
<p><br></p>
</div>
</div>
<div id="many-more-diagnostics-with-shinystan" class="section level3">
<h3><strong>Many more diagnostics with shinystan</strong></h3>
<p>Probably the most popular diagnostic for Bayesian regression in R is the functionality from the <a href="https://www.rdocumentation.org/packages/shinystan">shinystan package</a>.</p>
<ul>
<li>Shinystan launches a “Shiny” web application to show you model diagnostics, so it can’t be done inside of a RMarkdown document (but works just fine if called from the console.)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Do in console not RMarkdown</span>
<span class="kw">launch_shinystan</span>(TitanicLinear)</code></pre></div>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
